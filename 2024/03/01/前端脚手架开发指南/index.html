
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.27.0" theme-name="Stellar" theme-version="1.27.0">
  
  <meta name="generator" content="Hexo 7.1.1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="referrer" content="no-referrer">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>前端脚手架开发指南 - JKK随笔</title>

  
    <meta name="description" content="你会学到什么其实脚手架并不实现，难的是最佳实践的整理和沉淀。本文不会涉及到最佳实践方面的内容，只是教会你如何实现一个最基础的脚手架，以此作为展示最佳实践的载体。 因为是手把手教妹子写脚手架，所以本文很详细，字数很多，大概有 3 万字左右，读完你会学到：  如何搭建一个脚手架的工程 如何开发和调试一个脚手架 脚手架中如何接收和处理命令参数 脚手架中如何和用户交互 脚手架中如何拷贝一个文件夹或文件 脚">
<meta property="og:type" content="article">
<meta property="og:title" content="前端脚手架开发指南">
<meta property="og:url" content="https://panzhenjie.fun/2024/03/01/%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="JKK随笔">
<meta property="og:description" content="你会学到什么其实脚手架并不实现，难的是最佳实践的整理和沉淀。本文不会涉及到最佳实践方面的内容，只是教会你如何实现一个最基础的脚手架，以此作为展示最佳实践的载体。 因为是手把手教妹子写脚手架，所以本文很详细，字数很多，大概有 3 万字左右，读完你会学到：  如何搭建一个脚手架的工程 如何开发和调试一个脚手架 脚手架中如何接收和处理命令参数 脚手架中如何和用户交互 脚手架中如何拷贝一个文件夹或文件 脚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b51cb98a77714c3e9e0243b838f4a9ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7c494a99a1a439d8f214e3ae7ceefa9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16d6a0437e6e496f9550c6ebe6c61468~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3cf19e5988f4829938fb242fa44c68b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21572518624b44a395a56af189b24784~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f65e311299c46fbb9489e93456af443~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4622844145e45958e4f49d41150e143~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41b3499e416142d3922d5084a0b361c1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d26d96498a248f888e2b15fbd68ab2e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f050ee8dc63454187a63db4467ee91d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1920fc1ce75a4643bea172c1a904dc0a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efe05afa840448b2adc395f4b02fed99~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55c8f54e9eb9472eaba921894d65d6fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8bb0381d45c4b5195b07ec2ad25db59~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d1e97c3f4df4d8ba1bfdc842097c702~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1fa78ea9fc5a44289e354812af8d5105~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bbcce47772b4d8f8a34ecb469789348~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b767a9b5a844a9ab94918129184b046~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8bfac9d49bd48d38f0e76b5986678e1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf0a07ce24b744c787f3afc40d9b34a4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25ba0b7fdb6b427ebc9d3f09aa44a55d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f45d8c1c646648de96e3102a1ab4c773~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
<meta property="article:published_time" content="2024-03-01T01:09:12.000Z">
<meta property="article:modified_time" content="2024-08-29T12:44:10.915Z">
<meta property="article:author" content="stephenykk">
<meta property="article:tag" content="monorepo">
<meta property="article:tag" content="scaffold">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b51cb98a77714c3e9e0243b838f4a9ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
  
  
  
  <meta name="keywords" content="monorepo,scaffold">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.27.0">

  

  

  
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img referrerpolicy="no-referrer" no-lazy class="avatar" src="https://avatars.githubusercontent.com/u/7259892?s=400&u=01563911436a79d809f95ca8d1191c8a7ecc6f56&v=4" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">JKK随笔</div><div class="sub normal cap">搬砖工</div><div class="sub hover cap" style="opacity:0"> 但行好事 莫问前程</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="小学堂" href="/study/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2025/03/29/%E5%BC%BA%E5%A4%A7%E7%9A%84canvas%E5%BA%93Fabric-js%E5%9F%BA%E7%A1%80%E5%9B%BE%E8%A7%A3/"><span class="title">强大的canvas库Fabric.js基础图解</span></a><a class="item title" href="/2025/02/21/%E5%80%BC%E5%BE%97%E4%BA%86%E8%A7%A3%E7%9A%84Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/"><span class="title">值得了解的Python虚拟环境</span></a><a class="item title" href="/2025/03/21/%E5%A6%82%E4%BD%95%E7%94%A8vimdiff%E8%A7%A3%E5%86%B3%E5%90%88%E5%B9%B6%E5%86%B2%E7%AA%81/"><span class="title">如何用vimdiff解决合并冲突</span></a><a class="item title" href="/2025/03/26/%E4%B8%80%E4%B8%AA%E5%85%8D%E8%B4%B9%E5%AD%A6%E4%B9%A0%E7%94%9F%E8%AF%8D%E7%9A%84%E8%BD%BB%E5%BA%94%E7%94%A8/"><span class="title">一个免费学习生词的轻应用</span></a><a class="item title" href="/2025/03/04/%E5%BC%80%E5%8F%91%E8%80%85%E9%83%BD%E5%BA%94%E8%AF%A5%E4%BA%86%E8%A7%A3%E7%9A%84DNS%E7%9F%A5%E8%AF%86/"><span class="title">开发者都应该了解的DNS知识</span></a><a class="item title" href="/2024/04/12/Canvas%E5%85%A5%E9%97%A8%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%A7%A3/"><span class="title">Canvas入门知识图解</span></a><a class="item title" href="/2025/03/06/%E5%85%A8%E9%9D%A2%E4%BA%86%E8%A7%A3DNS%E5%92%8CDoH-DoT/"><span class="title">全面了解DNS和DoH/DoT</span></a><a class="item title" href="/2025/02/21/%E6%9C%89%E5%BF%85%E8%A6%81%E4%BA%86%E8%A7%A3python%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6requirements-txt/"><span class="title">有必要了解python项目的依赖管理文件requirements.txt</span></a><a class="item title" href="/2025/02/17/%E5%85%A8%E9%9D%A2%E8%AE%A4%E8%AF%86%E6%B5%81%E8%A1%8C%E7%9A%84SSR%E6%A1%86%E6%9E%B6Nextjs/"><span class="title">全面认识流行的SSR框架Nextjs</span></a><a class="item title" href="/2024/12/10/SQL%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"><span class="title">SQL基础入门</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/frontend/">frontend</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-03-01T01:09:12.000Z">2024-03-01</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-08-29T12:44:10.915Z">2024-08-29</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>前端脚手架开发指南</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h2 id="你会学到什么"><a href="#你会学到什么" class="headerlink" title="你会学到什么"></a>你会学到什么</h2><p>其实脚手架并不实现，难的是最佳实践的整理和沉淀。本文不会涉及到最佳实践方面的内容，只是教会你如何实现一个最基础的脚手架，以此作为展示最佳实践的载体。</p>
<p>因为是手把手教妹子写脚手架，所以本文很详细，字数很多，大概有 3 万字左右，读完你会学到：</p>
<ul>
<li>如何搭建一个脚手架的工程</li>
<li>如何开发和调试一个脚手架</li>
<li>脚手架中如何接收和处理命令参数</li>
<li>脚手架中如何和用户交互</li>
<li>脚手架中如何拷贝一个文件夹或文件</li>
<li>脚手架中如何动态生成一个文件</li>
<li>脚手架中如何处理路径问题</li>
<li>脚手架中如何自动安装模板所需依赖</li>
</ul>
<p>本文中所有代码已经上传到 <a target="_blank" rel="noopener" href="https://github.com/532pyh/mortal-cli" title="https://github.com/532pyh/mortal-cli">GitHub</a>。</p>
<h2 id="1、搭建一个-monorepo-风格的脚手架工程"><a href="#1、搭建一个-monorepo-风格的脚手架工程" class="headerlink" title="1、搭建一个 monorepo 风格的脚手架工程"></a>1、搭建一个 monorepo 风格的脚手架工程</h2><h3 id="1-1、如何用-Node-js-运行-js"><a href="#1-1、如何用-Node-js-运行-js" class="headerlink" title="1.1、如何用 Node.js 运行 js"></a>1.1、如何用 Node.js 运行 js</h3><blockquote>
<p>为了避免 Node.js 版本差异导致奇怪的问题，建议安装 16 以上版本的 Node.js 。</p>
</blockquote>
<p>随便找个地方建个一个 <em>index.js</em> 文件，并在该文件中添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Welcome to Mortal World&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>在该文件的地址栏上输出 <code>cmd</code> 打开命令行窗口，输入 <code>node index.js</code> 命令，回车运行该命令。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b51cb98a77714c3e9e0243b838f4a9ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>可以在命令行窗口中看到打印了  <code>Welcome to Mortals World</code>。</p>
<h3 id="1-2、声明自己的命令"><a href="#1-2、声明自己的命令" class="headerlink" title="1.2、声明自己的命令"></a>1.2、声明自己的命令</h3><p>如果你熟悉 <strong>Vue</strong> , 肯定对 <strong>vue-cli</strong> 这个脚手架有一定了解，比如运行 <code>vue create myapp</code> 命令来创建一个 <strong>Vue</strong> 工程。</p>
<p>如果我们没有运行 <code>npm install -g vue-cli</code> 安装 vue-cli 脚手架，在命令行窗口中直接运行 <code>vue create myapp</code>，会报错，报错如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7c494a99a1a439d8f214e3ae7ceefa9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>可见 <code>vue</code> 不是系统命令， <code>vue</code> 只是 vue-cli 脚手架声明的一个命令。</p>
<p>那怎么给脚手架声明一个命令，其实非常简单，跟我来操作。</p>
<p>随便找个地方创建 <em>mortal-cli</em> 的文件夹，进入该文件夹后，在其地址栏上输出 <code>cmd</code> 打开命令行窗口，</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16d6a0437e6e496f9550c6ebe6c61468~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>运行 <code>npm init</code> 命令来初始化一个脚手架工程，运行成功后，会在该文件夹中生成一个 <em>pakeage.json</em> 文件。</p>
<p>我们在 <em>pakeage.json</em> 中添加 <code>bin</code> 字段，来声明一个命令，添加后的代码如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mortal-cli&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ISC&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;bin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./bin/index.js&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>这样我们就声明了一个 <code>mortal</code> 的命令，另外 <code>./bin/index.js</code> 是运行 <code>mortal</code> 命令后会运行的 js 文件的相对路径。</p>
<p>接着我们在 <em>mortal-cli</em> 的文件夹中创建一个 <em>bin</em> 文件夹，在 <em>bin</em> 文件夹中创建一个 <em>index.js</em> 文件，并在该文件中添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Welcome to Mortal World&quot;</span>);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意在文件头部添加 <code>#!/usr/bin/env node</code>，否则运行后会报错！！！</p>
</blockquote>
<p>这样就完成了一个最基础的脚手架工程，接下来在命令行窗口输入 <code>mortal</code> 命令，运行该命令。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3cf19e5988f4829938fb242fa44c68b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>会发现，还是报错，提示 <code>mortal</code> 命令不是系统命令，当然不是声明命令的方法错误。</p>
<p>假如你把这个脚手架发布到 npm 上后。由于 <em>mortal-cli&#x2F;pakeage.json</em> 中 <code>name</code> 的值为 <code>mortal-cli</code>，所以我们运行 <code>npm install -g mortal-cli</code> 将脚手架安装到本地后，再运行 <code>mortal</code> 命令，就会发现运行成功。</p>
<p>在实际开发脚手架过程中不可能这么做，所以我们还要实现本地调试脚手架的能力，实现起来也非常简单，一个命令搞定。</p>
<p>这个命令就是 <code>npm link</code>，哈哈想不到吧，在这里就不讲述其原理，如果你们需要的话，可以留言，我开个单章讲述一下。</p>
<p>输入 <code>npm link</code> 命令运行后，再输入 <code>mortal</code> 命令，回车运行，看到的结果如下图所示。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21572518624b44a395a56af189b24784~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>到此，我们成功的声明了一个 <code>mortal</code> 命令。</p>
<h3 id="1-3、npm-link-的弊端"><a href="#1-3、npm-link-的弊端" class="headerlink" title="1.3、npm link 的弊端"></a>1.3、npm link 的弊端</h3><p>使用 <code>npm link</code> 来实现本地调试有一个弊端。比如在本地有多个版本的脚手架仓库，在仓库 A 中修改代码后，运行 <code>mortal</code> 命令后，发现更改的代码不生效。这是因为已经在仓库 B 的脚手架工程中运行 <code>npm link</code>，导致我们在运行 <code>mortal</code> 命令后是执行仓库 B 中的代码，在仓库 A 中修改代码能生效才怪。要先在仓库 B 的脚手架工程中运行 <code>npm unlink</code> 后，然后在仓库 A 中的脚手架工程中运行 <code>npm link</code> 后，修改仓库 A 中的代码才能生效。</p>
<p>为了解决这个弊端，我们使用 <strong>pnpm</strong> 来搭建 <strong>monorepo</strong> 风格的脚手架工程。</p>
<p>在 <strong>monorepo</strong> 风格的工程中可以含有多个子工程，且每个子工程都可以独立编译打包后将产物发成 <strong>npm</strong> 包，故又称 <strong>monorepo</strong> 为多包工程。</p>
<p>由于脚手架发布到 <strong>npm</strong> 上的包名为 <strong>mortal-cli</strong> ，修改调试子工程的 <em>package.json</em> 文件中的代码，代码修改部分如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mortal --help&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal-cli&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;workspace:*&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>注意，在 <code>dependencies</code> 字段中声明 <strong>mortal-cli</strong> 依赖包的版本，要用<code>workspace:*</code> 来定义，而不是具体版本号来定义。</p>
<blockquote>
<p>在 pnpm 中使用 workspace: 协议定义某个依赖包版本号时，pnpm 将只解析存在工作空间内的依赖包，不会去下载解析 npm 上的依赖包。</p>
</blockquote>
<p>把 <strong>mortal-cli</strong> 依赖包引入，执行 <code>pnpm i</code> 安装依赖，其效果就跟执行 <code>npm install -g mortal-cli</code>一样，只不过不是全局安装而已，只在调试子工程内安装 <strong>mortal-cli</strong> 脚手架。然后调试子工程就直接引用脚手架子工程本地编译打包后的产物，而不是发布到 npm 上的产物，彻底做到本地调试。</p>
<p>另外脚手架子工程和调试子工程是在同一个工程中，这样就做一对一的调试，从而解决了使用 <code>npm link</code> 来实现本地调试的弊端。</p>
<p>同时在 <code>scripts</code> 定义了脚本命令，在调试工程中执行 <code>pnpm mortal</code> 既是执行了 <code>mortal</code> 命令，不用脚手架工程中执行 <code>npm link</code> 就可以运行 <code>mortal</code> 命令。</p>
<h3 id="1-4、monorepo-风格的脚手架工程"><a href="#1-4、monorepo-风格的脚手架工程" class="headerlink" title="1.4、monorepo 风格的脚手架工程"></a>1.4、monorepo 风格的脚手架工程</h3><p>下面开始使用 <strong>pnpm</strong> 搭建 <strong>monorepo</strong> 风格的脚手架工程，首先在命令行窗口中输入以下代码，执行安装 <strong>pnpm</strong> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">iwr <span class="hljs-attr">https</span>:<span class="hljs-comment">//get.pnpm.io/install.ps1 -useb | iex</span><br></code></pre></td></tr></table></figure>

<p>然后重新找个地方创建 <em>mortal</em> 文件夹，进入该文件夹后，在其地址栏上输出 cmd 打开命令行窗口。</p>
<p>输入 <code>pnpm init</code> 初始化工程，<strong>pnpm</strong> 是使用 <strong>workspace</strong> (工作空间) 来搭建一个 <strong>monorepo</strong> 风格的工程。</p>
<p>所以我们要 <em>mortal</em> 文件夹中创建 <em>pnpm-workspace.yaml</em> 工作空间配置文件，并在该文件中添加如下配置代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">packages</span>: -<span class="hljs-string">&quot;packages/*&quot;</span> - <span class="hljs-string">&quot;examples/*&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>配置后，声明了 <em>packages</em> 和 <em>examples</em> 文件夹中子工程是同属一个工作空间的，工作空间中的子工程编译打包的产物都可以被其它子工程引用。</p>
<p>在 <em>packages</em> 文件夹中新建 <em>mortal-cli</em> 文件夹，在其地址栏上输出 <code>cmd</code> 打开命令行窗口。</p>
<p>输入 <code>pnpm init</code> 命令，执行来初始化一个工程，执行成功后，会在该文件夹中生成一个 <em>pakeage.json</em> 文件。</p>
<p>我们在 <em>pakeage.json</em> 中添加 <code>bin</code> 字段，来声明 <code>mortal</code> 命令，添加后的代码如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mortal-cli&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ISC&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;bin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./bin/index.js&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>在 <em>packages&#x2F;mortal-cli</em> 文件夹中新建 <em>bin</em> 文件夹，在 <em>bin</em> 文件夹中新建 <em>index.js</em> 文件，并在该文件中添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Welcome to Mortal World&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>在 <em>examples</em> 文件夹中新建 <em>app</em> 文件夹，在其地址栏上输出 cmd 打开命令行窗口， 运行 <code>pnpm init</code> 命令来初始化一个工程，运行成功后，会在该文件夹中生成一个 <em>pakeage.json</em> 文件。</p>
<p>我们在 <em>pakeage.json</em> 中添加 <code>dependencies</code> 字段，来添加 <strong>mortal-cli</strong> 依赖。再给 <code>scripts</code> 增加一条自定义脚本命令。添加后的代码如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;app&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mortal&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ISC&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal-cli&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;workspace:*&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>然后在最外层根目录下运行 <code>pnpm i</code> 命令，安装依赖。安装成功后，在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal</code>，会发现命令行窗口打印出 <code>Welcome to Mortal World</code>，说明你的 <strong>monorepo</strong> 风格的脚手架工程的搭建成功了。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f65e311299c46fbb9489e93456af443~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>此时整个工程的目录结构如下所示</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs md">|-- mortal<br>|-- package.json<br>|-- pnpm-lock.yaml<br>|-- pnpm-workspace.yaml<br>|-- examples<br>| |-- app<br>| |-- package.json<br>|-- packages<br>|-- mortal-cli<br>|-- package.json<br>|-- bin<br>|-- index.js<br></code></pre></td></tr></table></figure>

<h3 id="1-5、脚手架必备的模块"><a href="#1-5、脚手架必备的模块" class="headerlink" title="1.5、脚手架必备的模块"></a>1.5、脚手架必备的模块</h3><p>一个最简单的脚手架包含以下几个模块。</p>
<ul>
<li>命令参数模块</li>
<li>用户交互模块</li>
<li>文件拷贝模块</li>
<li>动态文件生成模块</li>
<li>自动安装依赖模块</li>
</ul>
<p>下面我们来一一将他们实现。</p>
<h2 id="2、命令参数模块"><a href="#2、命令参数模块" class="headerlink" title="2、命令参数模块"></a>2、命令参数模块</h2><h3 id="2-1、获取命令参数"><a href="#2-1、获取命令参数" class="headerlink" title="2.1、获取命令参数"></a>2.1、获取命令参数</h3><p><strong>Node.js</strong> 中的 <strong>process</strong> 模块提供了当前 <strong>Node.js</strong> 进程相关的全局环境信息，比如命令参数、环境变量、命令运行路径等等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> process = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;process&quot;</span>);<br><span class="hljs-comment">// 获取命令参数</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(process.<span class="hljs-property">argv</span>);<br></code></pre></td></tr></table></figure>

<p>脚手架提供的 <code>mortal</code> 命令后面还可以设置参数，标准的脚手架命令参数需要支持两种格式，比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">mortal --name=orderPage<br>mortal --name orderPage<br></code></pre></td></tr></table></figure>

<p>如果通过 <code>process.argv</code> 来获取，要额外处理两种不同的命令参数格式，不方便。</p>
<p>这里推荐 <strong>yargs</strong> 开源库来解析命令参数。运行以下命令安装 <strong>yargs</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">pnpm add yargs --F mortal-cli<br></code></pre></td></tr></table></figure>

<p><code>pnpm add</code> 是 <strong>pnpm</strong> 中安装依赖包的命令， <code>--F mortal-cli</code>，是指定依赖安装到 <strong>mortal-cli</strong> 子工程中。</p>
<blockquote>
<p>这里要注意，<code>mortal-cli</code> 是取 <strong>mortal-cli</strong> 子工程中 <em>package.json</em> 中 <code>name</code> 字段的值，而不是 <strong>mortal-cli</strong> 子工程文件夹的名称。</p>
</blockquote>
<p><strong>yargs</strong> 的使用非常简单，其提供的 <code>argv</code> 属性是对两个格式的命令参数的处理结果。</p>
<p>在 <em>bin&#x2F;index.js</em> 添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;name&quot;</span>, yargs.<span class="hljs-property">argv</span>.<span class="hljs-property">name</span>);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意，以上代码是在 Node.js 环境中运行，Node.js 的模块是遵循 CommonJS 规范的，如果要依赖一个模块，要使用 Node.js 内置 <code>require</code> 系统函数引用模块使用。</p>
</blockquote>
<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal -- --name=orderPage</code> ，</p>
<blockquote>
<p>注意，在 <code>pnpm mortal</code> 后面需要加上两个连字符（–），这是为了告诉 pnpm 后面的参数是传递给命令<code>mortal</code> 本身的，而不是传递给 <code>pnpm</code> 的。</p>
</blockquote>
<p>结果如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4622844145e45958e4f49d41150e143~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>可以通过 <code>yargs.argv.name</code> 获取命令参数 <code>name</code> 的值。</p>
<h3 id="2-2、设置子命令"><a href="#2-2、设置子命令" class="headerlink" title="2.2、设置子命令"></a>2.2、设置子命令</h3><p>假如脚手架要对外提供多个功能，不能将所有的功能都集中在 <code>mortal</code> 命令中实现。</p>
<p>可以通过 <strong>yargs</strong> 提供的 <code>command</code> 方法来设置一些子命令，让每个子命令对应各自功能，各司其职。</p>
<p><code>yargs.command</code> 的用法是 **yargs.command(cmd, desc, builder, handler)**。</p>
<ul>
<li><code>cmd</code>：字符串，子命令名称，也可以传递数组，如 <code>[&#39;create&#39;, &#39;c&#39;]</code>，表示子命令叫 <code>create</code>，其别名是 <code>c</code>；</li>
<li><code>desc</code>：字符串，子命令描述信息；</li>
<li><code>builder</code>：一个返回数组的函数，子命令参数信息配置，比如可以设置参数：<ul>
<li><code>alias</code>：别名；</li>
<li><code>demand</code>：是否必填；</li>
<li><code>default</code>：默认值；</li>
<li><code>describe</code>：描述信息；</li>
<li><code>type</code>：参数类型，<code>string | boolean | number</code>。</li>
</ul>
</li>
<li><code>handler</code>: 函数，可以在这个函数中专门处理该子命令参数。</li>
</ul>
<p>下面我们来设置一个用来生成一个模板的子命令，把这个子命令命名为<code>create</code>。</p>
<p>修改在 <em>bin&#x2F;index.js</em> 文件中的代码，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br>yargs.<span class="hljs-title function_">command</span>(<br>    [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],<br>    <span class="hljs-string">&quot;新建一个模板&quot;</span>,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">yargs</span>) &#123;<br>        <span class="hljs-keyword">return</span> yargs.<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;name&quot;</span>, &#123;<br>            <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;n&quot;</span>,<br>            <span class="hljs-attr">demand</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">describe</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        &#125;);<br>    &#125;,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">argv</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;argv&quot;</span>, argv);<br>    &#125;<br>).<span class="hljs-property">argv</span>;<br></code></pre></td></tr></table></figure>

<p>在 <em>app</em> 文件夹目录下分别运行 <code>pnpm mortal create -- --name=orderPage</code> 和 <code>pnpm mortal c -- --name=orderPage</code> 命令，执行结果如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41b3499e416142d3922d5084a0b361c1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>在上面我们配置了子命令 <code>create</code> 的参数 <code>name</code> 的一些参数信息。那这些要怎么展示给用户看呢？其实只要我们输入子命令的参数有错误，就会在命令行窗口中显示这些参数信息。</p>
<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal c -- --abc</code> 命令，执行结果如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d26d96498a248f888e2b15fbd68ab2e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>到此为止，我们最简单地实现了脚手架和用户之间的交互能力，但是如果自定义参数过多，那么命令行参数的交互方法对于用户来说是非常不友好的。所以我们还要实现一个用户交互模块，如何实现请看下一小节。</p>
<h2 id="3、用户交互模块"><a href="#3、用户交互模块" class="headerlink" title="3、用户交互模块"></a>3、用户交互模块</h2><p>我认为比较好的用户交互方式是讯问式的交互，比如我们在运行 <code>npm init</code>，通过询问式的交互完成 <em>package.json</em> 文件内容的填充。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f050ee8dc63454187a63db4467ee91d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>这里推荐使用 <strong>inquirer</strong> 开源库来实现询问式的交互，运行以下命令安装 <strong>inquirer</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">pnpm add inquirer@<span class="hljs-number">8.2</span><span class="hljs-number">.5</span> --F mortal-cli<br></code></pre></td></tr></table></figure>

<p>为了使用 <code>require</code> 引入 <strong>inquirer</strong> ，要使用 8.2.5 版本的 <strong>inquirer</strong>。</p>
<p>这里我们主要使用了 <strong>inquirer</strong> 开源库的三个方面的能力：</p>
<ul>
<li>询问用户问题</li>
<li>获取并解析用户的输入</li>
<li>检测用户的答案是否合法</li>
</ul>
<p>主要通过 <code>inquirer.prompt()</code> 来实现。<code>prompt</code> 函数接收一个数组，数组的每一项都是一个询问项，询问项有很多配置参数，下面是常用的配置项。</p>
<ul>
<li><code>type</code>：提问的类型，常用的有<ul>
<li>输入框：<code>input</code>；</li>
<li>确认：<code>confirm</code>；</li>
<li>单选组：<code>list</code>；</li>
<li>多选组：<code>checkbox</code>；</li>
</ul>
</li>
<li><code>name</code>：存储当前问题答案的变量；</li>
<li><code>message</code>：问题的描述；</li>
<li><code>default</code>：默认值；</li>
<li><code>choices</code>：列表选项，在某些<code>type</code>下可用；</li>
<li><code>validate</code>：对用户的答案进行校验；</li>
<li><code>filter</code>：对用户的答案进行过滤处理，返回处理后的值。</li>
</ul>
<p>比如我们创建一个模板文件，大概会询问用户：模板文件名称、模板类型、使用什么框架开发、使用框架对应的哪个组件库开发等等。下面我们来实现这个功能。</p>
<p>在 <em>bin</em> 文件夹中新建 <em>inquirer.js</em> 文件夹，在里面添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> inquirer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;inquirer&quot;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">inquirerPrompt</span>(<span class="hljs-params">argv</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; name &#125; = argv;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>        inquirer<br>            .<span class="hljs-title function_">prompt</span>([<br>                &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;input&quot;</span>,<br>                    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;name&quot;</span>,<br>                    <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>                    <span class="hljs-attr">default</span>: name,<br>                    <span class="hljs-attr">validate</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[a-zA-Z]+$/</span>.<span class="hljs-title function_">test</span>(val)) &#123;<br>                            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;模板名称只能含有英文&quot;</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[A-Z]/</span>.<span class="hljs-title function_">test</span>(val)) &#123;<br>                            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;模板名称首字母必须大写&quot;</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                    &#125;,<br>                &#125;,<br>                &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;list&quot;</span>,<br>                    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;type&quot;</span>,<br>                    <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;模板类型&quot;</span>,<br>                    <span class="hljs-attr">choices</span>: [<span class="hljs-string">&quot;表单&quot;</span>, <span class="hljs-string">&quot;动态表单&quot;</span>, <span class="hljs-string">&quot;嵌套表单&quot;</span>],<br>                    <span class="hljs-attr">filter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) &#123;<br>                        <span class="hljs-keyword">return</span> &#123;<br>                            表单: <span class="hljs-string">&quot;form&quot;</span>,<br>                            动态表单: <span class="hljs-string">&quot;dynamicForm&quot;</span>,<br>                            嵌套表单: <span class="hljs-string">&quot;nestedForm&quot;</span>,<br>                        &#125;[value];<br>                    &#125;,<br>                &#125;,<br>                &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;list&quot;</span>,<br>                    <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;使用什么框架开发&quot;</span>,<br>                    <span class="hljs-attr">choices</span>: [<span class="hljs-string">&quot;react&quot;</span>, <span class="hljs-string">&quot;vue&quot;</span>],<br>                    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;frame&quot;</span>,<br>                &#125;,<br>            ])<br>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>                <span class="hljs-keyword">const</span> &#123; frame &#125; = answers;<br>                <span class="hljs-keyword">if</span> (frame === <span class="hljs-string">&quot;react&quot;</span>) &#123;<br>                    inquirer<br>                        .<span class="hljs-title function_">prompt</span>([<br>                            &#123;<br>                                <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;list&quot;</span>,<br>                                <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;使用什么UI组件库开发&quot;</span>,<br>                                <span class="hljs-attr">choices</span>: [<span class="hljs-string">&quot;Ant Design&quot;</span>],<br>                                <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;library&quot;</span>,<br>                            &#125;,<br>                        ])<br>                        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers1</span>) =&gt;</span> &#123;<br>                            <span class="hljs-title function_">resolve</span>(&#123;<br>                                ...answers,<br>                                ...answers1,<br>                            &#125;);<br>                        &#125;)<br>                        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>                            <span class="hljs-title function_">reject</span>(error);<br>                        &#125;);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (frame === <span class="hljs-string">&quot;vue&quot;</span>) &#123;<br>                    inquirer<br>                        .<span class="hljs-title function_">prompt</span>([<br>                            &#123;<br>                                <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;list&quot;</span>,<br>                                <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;使用什么UI组件库开发&quot;</span>,<br>                                <span class="hljs-attr">choices</span>: [<span class="hljs-string">&quot;Element&quot;</span>],<br>                                <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;library&quot;</span>,<br>                            &#125;,<br>                        ])<br>                        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers2</span>) =&gt;</span> &#123;<br>                            <span class="hljs-title function_">resolve</span>(&#123;<br>                                ...answers,<br>                                ...answers2,<br>                            &#125;);<br>                        &#125;)<br>                        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>                            <span class="hljs-title function_">reject</span>(error);<br>                        &#125;);<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>                <span class="hljs-title function_">reject</span>(error);<br>            &#125;);<br>    &#125;);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">inquirerPrompt</span> = inquirerPrompt;<br></code></pre></td></tr></table></figure>

<p>其中 <code>inquirer.prompt()</code> 返回的是一个 Promise，我们可以用 <code>then</code> 获取上个询问的答案，根据答案再发起对应的内容。</p>
<p>在 <em>bin&#x2F;index.js</em> 中引入 <code>inquirerPrompt</code> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; inquirerPrompt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./inquirer&quot;</span>);<br><br>yargs.<span class="hljs-title function_">command</span>(<br>    [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],<br>    <span class="hljs-string">&quot;新建一个模板&quot;</span>,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">yargs</span>) &#123;<br>        <span class="hljs-keyword">return</span> yargs.<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;name&quot;</span>, &#123;<br>            <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;n&quot;</span>,<br>            <span class="hljs-attr">demand</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">describe</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        &#125;);<br>    &#125;,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">argv</span>) &#123;<br>        <span class="hljs-title function_">inquirerPrompt</span>(argv).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(answers);<br>        &#125;);<br>    &#125;<br>).<span class="hljs-property">argv</span>;<br></code></pre></td></tr></table></figure>

<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal c -- --n Input</code> 命令，执行结果如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1920fc1ce75a4643bea172c1a904dc0a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efe05afa840448b2adc395f4b02fed99~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>可以很清楚地看到“在使用什么框架开发”的询问中回答不同，下一个“使用什么 UI 组件库的开发”的询问可选项不一样。</p>
<p>回答完成后，可以在下图中清楚地看到答案格式</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55c8f54e9eb9472eaba921894d65d6fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<h2 id="4、文件夹拷贝模块"><a href="#4、文件夹拷贝模块" class="headerlink" title="4、文件夹拷贝模块"></a>4、文件夹拷贝模块</h2><p>要生成一个模板文件，最简单的做法就是执行脚手架提供的命令后，把脚手架中的模板文件，拷贝到对应的地方。模板文件可以是单个文件，也可以是一个文件夹。本小节先介绍一下模板文件是文件夹时候如何拷贝。</p>
<p>在 <strong>Node.js</strong> 中拷贝文件夹并不简单，需要用到递归，这里推荐使用开源库<strong>copy-dir</strong>来实现拷贝文件。</p>
<p>运行以下命令安装 <strong>copy-dir</strong> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">pnpm add copy-dir --F mortal-cli<br></code></pre></td></tr></table></figure>

<p>在 <em>bin</em> 文件夹中新建 <em>copy.js</em> 文件，在里面添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> copydir = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;copy-dir&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyDir</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, options</span>) &#123;<br>    copydir.<span class="hljs-title function_">sync</span>(<span class="hljs-keyword">from</span>, to, options);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkMkdirExists</span>(<span class="hljs-params">path</span>) &#123;<br>    <span class="hljs-keyword">return</span> fs.<span class="hljs-title function_">existsSync</span>(path);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">checkMkdirExists</span> = checkMkdirExists;<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">copyDir</span> = copyDir;<br></code></pre></td></tr></table></figure>

<p><code>copyDir</code> 方法实现非常简单，难的是如何使用，下面创建一个场景来介绍一下如何使用。</p>
<p>我们在 <em>bin</em> 文件夹中新建 <em>template</em> 文件夹，用来存放模板文件，比如在 <em>template</em> 文件夹中创建一个 <em>form</em> 文件夹来存放表单模板，这里不介绍表单模板的内容，我们随意在 <em>form</em> 文件夹中创建一个 _index.js_，在里面随便写些内容。其目录结构如下所示：</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs md">|-- mortal<br>|-- package.json<br>|-- pnpm-lock.yaml<br>|-- pnpm-workspace.yaml<br>|-- examples<br>| |-- app<br>| |-- package.json<br>|-- packages<br>|-- mortal<br>|-- package.json<br>|-- bin<br>|-- template<br>|-- form<br>|-- index.js<br>|-- copy.js<br>|-- index.js<br>|-- inquirer.js<br></code></pre></td></tr></table></figure>

<p>下面来实现把 <em>packages&#x2F;mortal&#x2F;bin&#x2F;template&#x2F;form</em> 这个文件夹拷贝到 <em>examples&#x2F;app&#x2F;src&#x2F;pages&#x2F;OrderPage</em> 中 。</p>
<p>在 <em>bin&#x2F;index.js</em> 修改代码，修改后的代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; inquirerPrompt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./inquirer&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; copyDir, checkMkdirExists &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./copy&quot;</span>);<br><br>yargs.<span class="hljs-title function_">command</span>(<br>    [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],<br>    <span class="hljs-string">&quot;新建一个模板&quot;</span>,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">yargs</span>) &#123;<br>        <span class="hljs-keyword">return</span> yargs.<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;name&quot;</span>, &#123;<br>            <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;n&quot;</span>,<br>            <span class="hljs-attr">demand</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">describe</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        &#125;);<br>    &#125;,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">argv</span>) &#123;<br>        <span class="hljs-title function_">inquirerPrompt</span>(argv).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> &#123; name, type &#125; = answers;<br>            <span class="hljs-keyword">const</span> isMkdirExists = <span class="hljs-title function_">checkMkdirExists</span>(<br>                path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>`</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (isMkdirExists) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span>文件夹已经存在`</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-title function_">copyDir</span>(<br>                    path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`./template/<span class="hljs-subst">$&#123;type&#125;</span>`</span>),<br>                    path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>`</span>)<br>                );<br>            &#125;<br>        &#125;);<br>    &#125;<br>).<span class="hljs-property">argv</span>;<br></code></pre></td></tr></table></figure>

<p>使用拷贝文件方法 <code>copyDir</code> 的难点是参数 <code>from</code> 和 <code>to</code> 的赋值。其中 <code>from</code> 表示要拷贝文件的路径，<code>to</code> 表示要把文件拷贝到那里的路径。这里的路径最好使用绝对路径，因为在 <strong>Node.js</strong> 中使用相对路径会出现一系列奇奇怪怪的问题。</p>
<h3 id="4-1、脚手架中的路径处理"><a href="#4-1、脚手架中的路径处理" class="headerlink" title="4.1、脚手架中的路径处理"></a>4.1、脚手架中的路径处理</h3><p>我们可以用 <strong>Node.js</strong> 中的 <strong>path</strong> 模块提供的 <code>path.resolve( [from…], to )</code> 方法将路径转成绝对路径，就是将参数 <code>to</code> 拼接成一个绝对路径，<code>[from … ]</code> 为选填项，可以设置多个路径，如 <code>path.resolve(&#39;./aaa&#39;, &#39;./bbb&#39;, &#39;./ccc&#39;)</code> ，使用时要注意<code>path.resolve</code> 的路径拼接规则：</p>
<ul>
<li>从后向前拼接路径；</li>
<li>若 <code>to</code> 以 <code>/</code> 开头，不会拼接到前面的路径；</li>
<li>若 <code>to</code> 以 <code>../</code> 开头，拼接前面的路径，且不含最后一节路径；</li>
<li>若 <code>to</code> 以 <code>./</code> 开头或者没有符号，则拼接前面路径。</li>
</ul>
<p>从以上拼接规则来看，使用 <code>path.resolve</code> 时，要特别注意参数 <code>to</code> 的设置。</p>
<p>下面来介绍一下，使用 <code>copyDir</code> 方法时，参数如何设置：</p>
<ul>
<li><p>将 <code>copyDir</code> 的参数 <code>from</code> 设置为 <code>path.resolve(__dirname, `./template/$&#123;type&#125;`)</code>，</p>
<p>其中 <code>__dirname</code> 是用来<strong>动态</strong>获取当前文件模块所属目录的绝对路径。比如在 <em>bin&#x2F;index.js</em> 文件中使用 <code>__dirname</code> ，<code>__dirname</code> 表示就是 <em>bin&#x2F;index.js</em> 文件所属目录的绝对路径 <code>D:\mortal\packages\mortal-cli\bin</code>。</p>
<p>因为模板文件存放在 <em>bin&#x2F;template</em> 文件夹中 ，<code>copyDir</code> 是在 <em>bin&#x2F;index.js</em> 中使用，<em>bin&#x2F;template</em> 文件夹相对 <em>bin&#x2F;index.js</em> 文件的路径是 <code>./template</code>，所以把 <code>path.resolve</code> 的参数 <code>to</code> 设置为 <code>./template/$&#123;type&#125;</code>，其中 <code>type</code> 是用户所选的模板类型。</p>
<p>假设 <code>type</code> 的模板类型是 <code>form</code>，那么 <code>path.resolve(__dirname, `./template/form`)</code> 得到的绝对路径是 <code>D:\mortal\packages\mortal-cli\bin\template\form</code>。</p>
</li>
<li><p>将 <code>copyDir</code> 的参数 <code>to</code> 设置为 <code>path.resolve(process.cwd(), `$&#123;name&#125;`)</code>，</p>
<p>其中 <code>process.cwd()</code> 当前 <strong>Node.js</strong> 进程执行时的文件所属目录的绝对路径。比如在 <em>bin</em> 文件夹目录下运行 <code>node index.js</code> 时，<code>process.cwd()</code> 得到的是 <code>D:\mortal\packages\mortal-cli\bin</code>。</p>
<p>运行 <code>node index.js</code> 相当运行 <code>mortal</code> 命令。而在现代前端工程中都是在 <em>package.json</em> 文件中<code>scripts</code>  定义了脚本命令，如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;app&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mortal&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ISC&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;mortal-cli&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;workspace:*&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>运行 <code>pnpm mortal</code> 就相当运行 <code>mortal</code> 命令，那么执行 <code>pnpm mortal</code> 时，当前 <strong>Node.js</strong> 进程执行时的文件是 <em>package.json</em> 文件。那么 <code>process.cwd()</code> 得到的是 <code>D:\mortal\examples\app</code>。</p>
<p>因为要把 <em>packages&#x2F;mortal&#x2F;bin&#x2F;template&#x2F;form</em> 这个文件夹拷贝到 <em>examples&#x2F;app&#x2F;src&#x2F;pages&#x2F;OrderPage</em> 中，且 <code>process.cwd()</code> 的值是<code>D:\mortal\examples\app</code>，<em>src&#x2F;pages</em> 文件夹相对 <em>examples&#x2F;app</em> 的路径是 <code>./src/pages</code> ，所以把 <code>path.resolve</code> 的参数 <code>to</code> 设置为 <code>./src/pages/$&#123;name&#125;</code>，其中 <code>name</code> 是用户所输入的模板名称。</p>
</li>
</ul>
<h3 id="4-2、目录守卫"><a href="#4-2、目录守卫" class="headerlink" title="4.2、目录守卫"></a>4.2、目录守卫</h3><p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal create -- --name=OrderPage</code>，看能不能成功得把 <em>packages&#x2F;mortal&#x2F;bin&#x2F;template&#x2F;form</em> 这个文件夹拷贝到 <em>examples&#x2F;app&#x2F;src&#x2F;pages&#x2F;OrderPage</em> 中。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8bb0381d45c4b5195b07ec2ad25db59~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>报错了，提示 <em>examples&#x2F;app&#x2F;src&#x2F;pages</em> 文件夹不存在。为了防止这种报错出现，我们要实现一个目录守护的方法 <code>mkdirGuard</code> ，比如 <em>examples&#x2F;app&#x2F;src&#x2F;pages</em> 文件夹不存在，就创建一个 <em>examples&#x2F;app&#x2F;src&#x2F;pages</em> 文件夹。</p>
<p>在 <em>bin&#x2F;copy.js</em> 文件中，修改代码，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> copydir = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;copy-dir&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">mkdirGuard</span>(<span class="hljs-params">target</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        fs.<span class="hljs-title function_">mkdirSync</span>(target, &#123; <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-title function_">mkdirp</span>(target);<br>        <span class="hljs-keyword">function</span> <span class="hljs-title function_">mkdirp</span>(<span class="hljs-params">dir</span>) &#123;<br>            <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(dir)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">const</span> dirname = path.<span class="hljs-title function_">dirname</span>(dir);<br>            <span class="hljs-title function_">mkdirp</span>(dirname);<br>            fs.<span class="hljs-title function_">mkdirSync</span>(dir);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyDir</span>(<span class="hljs-params">form, to, options</span>) &#123;<br>    <span class="hljs-title function_">mkdirGuard</span>(to);<br>    copydir.<span class="hljs-title function_">sync</span>(form, to, options);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkMkdirExists</span>(<span class="hljs-params">path</span>) &#123;<br>    <span class="hljs-keyword">return</span> fs.<span class="hljs-title function_">existsSync</span>(path);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">checkMkdirExists</span> = checkMkdirExists;<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">mkdirGuard</span> = mkdirGuard;<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">copyDir</span> = copyDir;<br></code></pre></td></tr></table></figure>

<p><code>fs.mkdirSync</code> 的语法格式：<code>fs.mkdirSync(path[, options])</code>，创建文件夹目录。</p>
<ul>
<li><code>path</code>：文件夹目录路径；</li>
<li><code>options</code>：<code>recursive</code> 表示是否要创建父目录，<code>true</code> 要。</li>
</ul>
<p><code>fs.existsSync</code> 的语法格式：<code>fs.existsSync(pach)</code>，检测目录是否存在，如果目录存在返回  <code>true</code> ，如果目录不存在返回<code>false</code>。</p>
<ul>
<li><code>path</code>：文件夹目录路径。</li>
</ul>
<p><code>path.dirname</code> 的语法格式：<code>path.dirname(path)</code>，用于获取给定路径的目录名。</p>
<ul>
<li><code>path</code>：文件路径。</li>
</ul>
<p>在 <code>mkdirGuard</code> 方法内部，当要创建的目录 <code>target</code> 父级目录不存在时，调用<code>fs.mkdirSync(target)</code>，会报错走 <code>catch</code> 部分逻辑，在其中递归创建父级目录，使用 <code>fs.existsSync(dir)</code> 来判断父级目录是否存在，来终止递归。这里要特别注意 <code>fs.mkdirSync(dir)</code> 创建父级目录要在 <code>mkdirp(dirname)</code> 之前调用，才能形成一个正确的创建顺序，否则创建父级目录过程会因父级目录的父级目录不存在报错。</p>
<p>我们再次在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal create -- --name=OrderPage</code>，看这次能不能成功得把 <em>packages&#x2F;mortal&#x2F;bin&#x2F;template&#x2F;form</em> 这个文件夹拷贝到 <em>examples&#x2F;app&#x2F;src&#x2F;pages&#x2F;OrderPage</em> 中。</p>
<p>成功添加，添加结果如下所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d1e97c3f4df4d8ba1bfdc842097c702~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>然后再运行 <code>pnpm mortal create -- --name=OrderPage</code> 命令，会发现控制台打印出模板已经存在在提示。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1fa78ea9fc5a44289e354812af8d5105~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>这是为了防止用户修改后的模板文件，运行命令后被重新覆盖到初始状态。所以我们引入一个校验模板文件是否存在的 <code>checkMkdirExists</code> 方法，内部采用 <code>fs.existsSync</code> 来实现。</p>
<h2 id="5、文件拷贝模块"><a href="#5、文件拷贝模块" class="headerlink" title="5、文件拷贝模块"></a>5、文件拷贝模块</h2><p>文件拷贝分三步来实现，使用 <code>fs.readFileSync</code> 读取被拷贝的文件内容，然后创建一个文件，再使用 <code>fs.writeFileSync</code> 写入文件内容。</p>
<p>在 <em>bin&#x2F;copy.js</em> 文件，在里面添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFile</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) &#123;<br>    <span class="hljs-keyword">const</span> buffer = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-keyword">from</span>);<br>    <span class="hljs-keyword">const</span> parentPath = path.<span class="hljs-title function_">dirname</span>(to);<br><br>    <span class="hljs-title function_">mkdirGuard</span>(parentPath);<br><br>    fs.<span class="hljs-title function_">writeFileSync</span>(to, buffer);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">copyFile</span> = copyFile;<br></code></pre></td></tr></table></figure>

<p>接下来我们使用 <code>copyFile</code> 方法，在 <em>bin&#x2F;index.js</em> 修改代码，修改后的代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; inquirerPrompt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./inquirer&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; copyDir &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./copy&quot;</span>);<br><br>yargs.<span class="hljs-title function_">command</span>(<br>    [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],<br>    <span class="hljs-string">&quot;新建一个模板&quot;</span>,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">yargs</span>) &#123;<br>        <span class="hljs-keyword">return</span> yargs.<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;name&quot;</span>, &#123;<br>            <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;n&quot;</span>,<br>            <span class="hljs-attr">demand</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">describe</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        &#125;);<br>    &#125;,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">argv</span>) &#123;<br>        <span class="hljs-title function_">inquirerPrompt</span>(argv).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> &#123; name, type &#125; = answers;<br>            <span class="hljs-keyword">const</span> isMkdirExists = <span class="hljs-title function_">checkMkdirExists</span>(<br>                path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>/index.js`</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (isMkdirExists) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span>/index.js文件已经存在`</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-title function_">copyFile</span>(<br>                    path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`./template/<span class="hljs-subst">$&#123;type&#125;</span>/index.js`</span>),<br>                    path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>/index.js`</span>),<br>                    &#123;<br>                        name,<br>                    &#125;<br>                );<br>            &#125;<br>        &#125;);<br>    &#125;<br>).<span class="hljs-property">argv</span>;<br></code></pre></td></tr></table></figure>

<p><code>copyFile</code> 和 <code>copyDir</code> 使用的区别在参数，<code>copyFile</code> 要求参数 <code>from</code> 和参数 <code>to</code> 都精确到文件路径。</p>
<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal create -- --name=OrderPage</code>，执行结果如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bbcce47772b4d8f8a34ecb469789348~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<h2 id="6、动态文件生成模块"><a href="#6、动态文件生成模块" class="headerlink" title="6、动态文件生成模块"></a>6、动态文件生成模块</h2><p>假设脚手架中提供的模板文件中某些信息需要根据用户输入的命令参数来动态生成对应的模板文件。</p>
<p>比如下面模板文件中 <code>App</code> 要动态替换成用户输入的命令参数 <code>name</code> 的值，该如何实现呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;<br></code></pre></td></tr></table></figure>

<p>这里推荐使用开源库<strong>mustache</strong>来实现，运行以下命令安装 <strong>copy-dir</strong> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">pnpm <span class="hljs-keyword">add</span> mustache <span class="hljs-comment">--F mortal-cli</span><br></code></pre></td></tr></table></figure>

<p>我们在 <em>packages&#x2F;mortal-cli&#x2F;bin&#x2F;template&#x2F;form</em> 文件夹中创建一个 <em>index.tpl</em> 文件，内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">const</span> &#123;&#123;name&#125;&#125; = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;&#123;name&#125;&#125;;<br></code></pre></td></tr></table></figure>

<p>先写一个 <code>readTemplate</code> 方法来读取这个 <em>index.tpl</em> 动态模板文件内容。在 <em>bin&#x2F;copy.js</em> 文件，在里面添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Mustache</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mustache&quot;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">readTemplate</span>(<span class="hljs-params">path, data = &#123;&#125;</span>) &#123;<br>    <span class="hljs-keyword">const</span> str = fs.<span class="hljs-title function_">readFileSync</span>(path, &#123; <span class="hljs-attr">encoding</span>: <span class="hljs-string">&quot;utf8&quot;</span> &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(str, data);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">readTemplate</span> = readTemplate;<br></code></pre></td></tr></table></figure>

<p><code>readTemplate</code> 方法接收两个参数，<code>path</code> 动态模板文件的相对路径，<code>data</code> 动态模板文件的配置数据。</p>
<p>使用 <code>Mustache.render(str, data)</code> 生成模板文件内容返回，因为 <code>Mustache.render</code> 的第一个参数类型是个字符串，所以在调用 <code>fs.readFileSync</code> 时要指定 <code>encoding</code> 类型为 <code>utf8</code>，否则 <code>fs.readFileSync</code> 返回 Buffer 类型数据。</p>
<p>在写一个 <code>copyTemplate</code> 方法来拷贝模板文件到对应的地方，跟 <code>copyFile</code> 方法非常相似。在 <em>bin&#x2F;copy.js</em> 文件，在里面添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyTemplate</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, data = &#123;&#125;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">extname</span>(<span class="hljs-keyword">from</span>) !== <span class="hljs-string">&quot;.tpl&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">copyFile</span>(<span class="hljs-keyword">from</span>, to);<br>    &#125;<br>    <span class="hljs-keyword">const</span> parentToPath = path.<span class="hljs-title function_">dirname</span>(to);<br>    <span class="hljs-title function_">mkdirGuard</span>(parentToPath);<br>    fs.<span class="hljs-title function_">writeFileSync</span>(to, <span class="hljs-title function_">readTemplate</span>(<span class="hljs-keyword">from</span>, data));<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>path.extname(from)</code> 返回文件扩展名，比如 <code>path.extname(index.tpl)</code> 返回 <code>.tpl</code>。</p>
<p>在 <em>bin&#x2F;index.js</em> 修改代码，修改后的代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; inquirerPrompt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./inquirer&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; copyTemplate &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./copy&quot;</span>);<br><br>yargs.<span class="hljs-title function_">command</span>(<br>    [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],<br>    <span class="hljs-string">&quot;新建一个模板&quot;</span>,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">yargs</span>) &#123;<br>        <span class="hljs-keyword">return</span> yargs.<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;name&quot;</span>, &#123;<br>            <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;n&quot;</span>,<br>            <span class="hljs-attr">demand</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">describe</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        &#125;);<br>    &#125;,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">argv</span>) &#123;<br>        <span class="hljs-title function_">inquirerPrompt</span>(argv).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> &#123; name, type &#125; = answers;<br>            <span class="hljs-keyword">const</span> isMkdirExists = <span class="hljs-title function_">checkMkdirExists</span>(<br>                path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>/index.js`</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (isMkdirExists) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span>/index.js文件已经存在`</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-title function_">copyTemplate</span>(<br>                    path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`./template/<span class="hljs-subst">$&#123;type&#125;</span>/index.tpl`</span>),<br>                    path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>/index.js`</span>),<br>                    &#123;<br>                        name,<br>                    &#125;<br>                );<br>            &#125;<br>        &#125;);<br>    &#125;<br>).<span class="hljs-property">argv</span>;<br></code></pre></td></tr></table></figure>

<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal create -- --name=OrderPage</code>，执行结果如下图所示：</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b767a9b5a844a9ab94918129184b046~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<h3 id="6-1、mustache-简介"><a href="#6-1、mustache-简介" class="headerlink" title="6.1、mustache 简介"></a>6.1、mustache 简介</h3><p>以上的案例是 <strong>mustache</strong> 最简单的使用，下面来额外介绍一些常用的使用场景。</p>
<p>首先来熟悉一下 <strong>mustache</strong> 的语法，下面来介绍一些场景来使用这些语法</p>
<ul>
<li><code>&#123;&#123;key&#125;&#125;</code></li>
<li><code>&#123;&#123;#key&#125;&#125; &#123;&#123;/key&#125;&#125;</code></li>
<li><code>&#123;&#123;^key&#125;&#125; &#123;&#123;/key&#125;&#125;</code></li>
<li><code>&#123;&#123;.&#125;&#125;</code></li>
<li><code>&#123;&#123;&key&#125;&#125;</code></li>
</ul>
<h4 id="6-1-1、简单绑定"><a href="#6-1-1、简单绑定" class="headerlink" title="6.1.1、简单绑定"></a>6.1.1、简单绑定</h4><p>使用 <code>&#123;&#123;key&#125;&#125;</code> 语法，<code>key</code> 要和 <code>Mustache.render</code> 方法中的第二个参数（一个对象）的属性名一致。</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;name&#125;&#125;&lt;/span&gt;&quot;</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span> &#125;);<br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;span&gt;张三&lt;/span&gt;<br></code></pre></td></tr></table></figure>

<h4 id="6-1-2、绑定子属性"><a href="#6-1-2、绑定子属性" class="headerlink" title="6.1.2、绑定子属性"></a>6.1.2、绑定子属性</h4><p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;ifno.name&#125;&#125;&lt;/span&gt;&quot;</span>, &#123; <span class="hljs-attr">ifno</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span> &#125; &#125;);<br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;span&gt;张三&lt;/span&gt;<br></code></pre></td></tr></table></figure>

<h4 id="6-1-3、循环渲染"><a href="#6-1-3、循环渲染" class="headerlink" title="6.1.3、循环渲染"></a>6.1.3、循环渲染</h4><p>如果 <code>key</code> 属性值是一个数组，则可以使用 <code>&#123;&#123;#key&#125;&#125; &#123;&#123;/key&#125;&#125;</code> 语法来循环展示。 其中 <code>&#123;&#123;#&#125;&#125;</code> 标记表示从该标记以后的内容全部都要循环展示，<code>&#123;&#123;/&#125;&#125;</code>标记表示循环结束。</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;#list&#125;&#125;&#123;&#123;name&#125;&#125;&#123;&#123;/list&#125;&#125;&lt;/span&gt;&quot;</span>, &#123;<br>    <span class="hljs-attr">list</span>: [&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span> &#125;, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;李四&quot;</span> &#125;, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;王五&quot;</span> &#125;],<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;span&gt;张三李四王五&lt;/span&gt;<br></code></pre></td></tr></table></figure>

<p>如果 <code>list</code> 的值是 <code>[&#39;张三&#39;,&#39;李四&#39;,&#39;王五&#39;]</code>，要把 <code>&#123;&#123;name&#125;&#125;</code> 替换成 <code>&#123;&#123;.&#125;&#125;</code> 才可以渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;#list&#125;&#125;&#123;&#123;.&#125;&#125;&#123;&#123;/list&#125;&#125;&lt;/span&gt;&quot;</span>, &#123;<br>    <span class="hljs-attr">list</span>: [<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;王五&quot;</span>],<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="6-1-4、循环中二次处理数据"><a href="#6-1-4、循环中二次处理数据" class="headerlink" title="6.1.4、循环中二次处理数据"></a>6.1.4、循环中二次处理数据</h4><p><code>Mustache.render</code> 方法中的第二个参数是个对象，其属性值可以是一个函数，渲染时候会执行函数输出返回值，函数中可以用 <code>this</code> 获取第二个参数的上下文。</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;#list&#125;&#125;&#123;&#123;info&#125;&#125;&#123;&#123;/list&#125;&#125;&lt;/span&gt;&quot;</span>, &#123;<br>    <span class="hljs-attr">list</span>: [&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span> &#125;, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;李四&quot;</span> &#125;, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;王五&quot;</span> &#125;],<br>    <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;,&quot;</span>;<br>    &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;span&gt;张三,李四,王五,&lt;/span&gt;<br></code></pre></td></tr></table></figure>

<h4 id="6-1-5、条件渲染"><a href="#6-1-5、条件渲染" class="headerlink" title="6.1.5、条件渲染"></a>6.1.5、条件渲染</h4><p>使用 <code>&#123;&#123;#key&#125;&#125; &#123;&#123;/key&#125;&#125;</code> 语法 和 <code>&#123;&#123;^key&#125;&#125; &#123;&#123;/key&#125;&#125;</code> 语法来实现条件渲染，当 <code>key</code> 为 <code>false</code>、<code>0</code>、<code>[]</code>、<code>&#123;&#125;</code>、<code>null</code>，既是 <code>key == false</code> 为真，<code>&#123;&#123;#key&#125;&#125; &#123;&#123;/key&#125;&#125;</code> 包裹的内容不渲染，<code>&#123;&#123;^key&#125;&#125; &#123;&#123;/key&#125;&#125;</code> 包裹的内容渲染</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;#show&#125;&#125;显示&#123;&#123;/show&#125;&#125;&#123;&#123;^show&#125;&#125;隐藏&#123;&#123;/show&#125;&#125;&lt;/span&gt;&quot;</span>, &#123;<br>    <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;span&gt;隐藏&lt;/span&gt;<br></code></pre></td></tr></table></figure>

<h4 id="6-1-6、不转义-HTML-标签"><a href="#6-1-6、不转义-HTML-标签" class="headerlink" title="6.1.6、不转义 HTML 标签"></a>6.1.6、不转义 HTML 标签</h4><p>使用 <code>&#123;&#123;&key&#125;&#125;</code> 语法来实现。</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mustache</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;&lt;span&gt;&#123;&#123;&amp;key&#125;&#125;&lt;/span&gt;&quot;</span>, &#123;<br>    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;&lt;span&gt;标题&lt;/span&gt;&quot;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;span&gt;&lt;span&gt;标题&lt;/span&gt;&lt;/span&gt;<br></code></pre></td></tr></table></figure>

<h2 id="7、自动安装依赖模块"><a href="#7、自动安装依赖模块" class="headerlink" title="7、自动安装依赖模块"></a>7、自动安装依赖模块</h2><p>假设模板是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Form</span>, <span class="hljs-title class_">Input</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;antd&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onFinish</span> = (<span class="hljs-params">values</span>) =&gt; &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success:&quot;</span>, values);<br>    &#125;;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">onFinish</span>=<span class="hljs-string">&#123;onFinish&#125;</span> <span class="hljs-attr">autoComplete</span>=<span class="hljs-string">&quot;off&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;Username&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> /&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">htmlType</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span></span><br><span class="language-xml">                    提交</span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span></span><br>    );<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;<br></code></pre></td></tr></table></figure>

<p>可以看到模板中使用了 <code>react</code> 和 <code>antd</code> 这两个第三方依赖，假如使用模板的工程中没有安装这两个依赖，我们要实现在生成模板过程中就自动安装这两个依赖。</p>
<p>我们使用 <strong>Node</strong> 中 <strong>child_process</strong> 子进程这个模块来实现。</p>
<p>在 <strong>child_process</strong> 子进程中的最常用的语法是：</p>
<p><code>child_process.exec(command, options, callback)</code></p>
<ul>
<li><code>command</code>：命令，比如 <code>pnpm install</code></li>
<li><code>options</code>：参数<ul>
<li><code>cwd</code>：设置命令运行环境的路径</li>
<li><code>env</code>：环境变量</li>
<li><code>timeout</code>：运行执行现在</li>
</ul>
</li>
<li><code>callback</code>：运行命令结束回调，<code>(error, stdout, stderr) =&gt;&#123; &#125;</code>，执行成功后 <code>error</code> 为 <code>null</code>，执行失败后 <code>error</code> 为 Error 实例，<code>stdout</code>、<code>stderr</code> 为标准输出、标准错误，其格式默认是字符串。</li>
</ul>
<p>在 <em>bin</em> 文件夹中新建 <em>inquirer.js</em> 文件夹，在里面添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; exec &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;child_process&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">LibraryMap</span> = &#123;<br>    <span class="hljs-string">&quot;Ant Design&quot;</span>: <span class="hljs-string">&quot;antd&quot;</span>,<br>    <span class="hljs-attr">iView</span>: <span class="hljs-string">&quot;view-ui-plus&quot;</span>,<br>    <span class="hljs-string">&quot;Ant Design Vue&quot;</span>: <span class="hljs-string">&quot;ant-design-vue&quot;</span>,<br>    <span class="hljs-title class_">Element</span>: <span class="hljs-string">&quot;element-plus&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">install</span>(<span class="hljs-params">cmdPath, options</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; frame, library &#125; = options;<br>    <span class="hljs-keyword">const</span> command = <span class="hljs-string">`pnpm add <span class="hljs-subst">$&#123;frame&#125;</span> &amp;&amp; pnpm add <span class="hljs-subst">$&#123;LibraryMap[library]&#125;</span>`</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) &#123;<br>        <span class="hljs-title function_">exec</span>(<br>            command,<br>            &#123;<br>                <span class="hljs-attr">cwd</span>: path.<span class="hljs-title function_">resolve</span>(cmdPath),<br>            &#125;,<br>            <span class="hljs-keyword">function</span> (<span class="hljs-params">error, stdout, stderr</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;error&quot;</span>, error);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;stdout&quot;</span>, stdout);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;stderr&quot;</span>, stderr);<br>            &#125;<br>        );<br>    &#125;);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">install</span> = install;<br></code></pre></td></tr></table></figure>

<p>在 <code>install</code> 方法中 <code>exec</code> 的参数 <code>command</code> 是 <strong>pnpm</strong> 安装依赖命令，安装多个依赖时使用 <code>&amp;&amp;</code> 拼接。参数 <code>cwd</code> 是所安装依赖工程的 <em>package.json</em> 文件路径，我们可以使用 <code>process.cwd()</code> 获取。已经在上文提到过，<code>process.cwd()</code> 是当前<strong>Node.js</strong> 进程执行时的文件所属目录的绝对路径。</p>
<p>接下来使用，在 <em>bin&#x2F;index.js</em> 修改代码，修改后的代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;yargs&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; inquirerPrompt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./inquirer&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; copyTemplate, checkMkdirExists &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./copy&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; install &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./manager&quot;</span>);<br><br>yargs.<span class="hljs-title function_">command</span>(<br>    [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],<br>    <span class="hljs-string">&quot;新建一个模板&quot;</span>,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">yargs</span>) &#123;<br>        <span class="hljs-keyword">return</span> yargs.<span class="hljs-title function_">option</span>(<span class="hljs-string">&quot;name&quot;</span>, &#123;<br>            <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;n&quot;</span>,<br>            <span class="hljs-attr">demand</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">describe</span>: <span class="hljs-string">&quot;模板名称&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        &#125;);<br>    &#125;,<br>    <span class="hljs-keyword">function</span> (<span class="hljs-params">argv</span>) &#123;<br>        <span class="hljs-title function_">inquirerPrompt</span>(argv).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> &#123; name, type &#125; = answers;<br>            <span class="hljs-keyword">const</span> isMkdirExists = <span class="hljs-title function_">checkMkdirExists</span>(<br>                path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>/index.js`</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (isMkdirExists) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span>/index.js文件已经存在`</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-title function_">copyTemplate</span>(<br>                    path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`./template/<span class="hljs-subst">$&#123;type&#125;</span>/index.tpl`</span>),<br>                    path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">`./src/pages/<span class="hljs-subst">$&#123;name&#125;</span>/index.js`</span>),<br>                    &#123;<br>                        name,<br>                    &#125;<br>                );<br>                <span class="hljs-title function_">install</span>(process.<span class="hljs-title function_">cwd</span>(), answers);<br>            &#125;<br>        &#125;);<br>    &#125;<br>).<span class="hljs-property">argv</span>;<br></code></pre></td></tr></table></figure>

<p>当执行完 <code>copyTemplate</code> 方法后，就开始执行 <code>install(process.cwd(), answers)</code> 自动安装模板中所需的依赖。</p>
<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal create -- --name=OrderPage</code>，看能不能自动安装依赖。</p>
<p>等命令执行完成后，观察 <em>examples\app\package.json</em> 文件中的 <code>dependencies</code> 值是不是添加了 <code>antd</code> 和 <code>react</code> 依赖。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8bfac9d49bd48d38f0e76b5986678e1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>此外，我们在执行命令中会发现，如下图所示的现象，光标一直在闪烁，好像卡住了，其中是依赖在安装。这里我们要引入一个加载动画，来解决这个不友好的现象。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf0a07ce24b744c787f3afc40d9b34a4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p>这里推荐使用开源库<strong>ora</strong>来实现加载动画。</p>
<p>运行以下命令安装 <strong>ora</strong> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">pnpm add ora@<span class="hljs-number">5.4</span><span class="hljs-number">.1</span> --F mortal-cli<br></code></pre></td></tr></table></figure>

<p>在 <em>bin&#x2F;inquirer.js</em> 修改代码，修改后的代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; exec &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;child_process&quot;</span>);<br><span class="hljs-keyword">const</span> ora = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ora&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">LibraryMap</span> = &#123;<br>    <span class="hljs-string">&quot;Ant Design&quot;</span>: <span class="hljs-string">&quot;antd&quot;</span>,<br>    <span class="hljs-attr">iView</span>: <span class="hljs-string">&quot;view-ui-plus&quot;</span>,<br>    <span class="hljs-string">&quot;Ant Design Vue&quot;</span>: <span class="hljs-string">&quot;ant-design-vue&quot;</span>,<br>    <span class="hljs-title class_">Element</span>: <span class="hljs-string">&quot;element-plus&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">install</span>(<span class="hljs-params">cmdPath, options</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; frame, library &#125; = options;<br>    <span class="hljs-keyword">const</span> command = <span class="hljs-string">`pnpm add <span class="hljs-subst">$&#123;frame&#125;</span> &amp;&amp; pnpm add <span class="hljs-subst">$&#123;LibraryMap[library]&#125;</span>`</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) &#123;<br>        <span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>();<br>        spinner.<span class="hljs-title function_">start</span>(<span class="hljs-string">`正在安装依赖，请稍等`</span>);<br>        <span class="hljs-title function_">exec</span>(<br>            command,<br>            &#123;<br>                <span class="hljs-attr">cwd</span>: path.<span class="hljs-title function_">resolve</span>(cmdPath),<br>            &#125;,<br>            <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;<br>                <span class="hljs-keyword">if</span> (error) &#123;<br>                    <span class="hljs-title function_">reject</span>();<br>                    spinner.<span class="hljs-title function_">fail</span>(<span class="hljs-string">`依赖安装失败`</span>);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                spinner.<span class="hljs-title function_">succeed</span>(<span class="hljs-string">`依赖安装成功`</span>);<br>                <span class="hljs-title function_">resolve</span>();<br>            &#125;<br>        );<br>    &#125;);<br>&#125;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">install</span> = install;<br></code></pre></td></tr></table></figure>

<p>在 <em>app</em> 文件夹目录下运行 <code>pnpm mortal create -- --name=OrderPage</code>，看一下执行效果。</p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25ba0b7fdb6b427ebc9d3f09aa44a55d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<p><img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f45d8c1c646648de96e3102a1ab4c773~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p>
<h2 id="8、发布和安装"><a href="#8、发布和安装" class="headerlink" title="8、发布和安装"></a>8、发布和安装</h2><p>在 <em>packages&#x2F;mortal</em> 文件夹目录下运行，运行以下命令安装将脚手架发布到 <strong>npm</strong> 上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">pnpm publish --F mortal-cli<br></code></pre></td></tr></table></figure>

<p>发布成功后。我们在一个任意工程中，执行 <code>pnpm add mortal-cli -D</code> 安装 <strong>mortal-cli</strong> 脚手架依赖成功后，在工程中执行 <code>pnpm mortal create -- --name=OrderPage</code> 命令即可。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>上面只教大家实现一个最最简单的脚手架。其功能就只有一个模板文件生成。虽然简单，但是这些都是脚手架的入门功，代码已经上传到 <a target="_blank" rel="noopener" href="https://github.com/532pyh/mortal-cli" title="https://github.com/532pyh/mortal-cli">GitHub</a>，大家可以下载下来，自己实践一下，光看不练永远学不会。</p>
<p>学会了，可以总结一些平时的业务代码，形成最佳实践，使用脚手架作为载体展现出来，提升自己的职场竞争力。</p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    
    <section id="share">
      <div class="header"><span>分享文章</span></div>
      <div class="body">
        <div class="link"><input class="copy-area" readonly="true" id="copy-link" value="https://panzhenjie.fun/2024/03/01/%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/" /></div>
        <div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot)"><img referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/b32ef3da1162a.svg" /></a><a class="social share-item weibo" target="_blank" rel="external nofollow noopener noreferrer" href="https://service.weibo.com/share/share.php?url=https://panzhenjie.fun/2024/03/01/%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/&title=前端脚手架开发指南 - JKK随笔&summary=你会学到什么其实脚手架并不实现，难的是最佳实践的整理和沉淀。本文不会涉及到最佳实践方面的内容，只是教会你如何实现一个最基础的脚手架，以此作为展示最佳实践的载体。
因为是手把手教妹子写脚手架，所以本文很详细，字数很多，大概有 3 万字左..."><img referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/80c07e4dbb303.svg" /></a><a class="social share-item email" href="mailto:?subject=前端脚手架开发指南 - JKK随笔&amp;body=https://panzhenjie.fun/2024/03/01/%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"><img referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/a1b00e20f425d.svg" /></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;复制成功&quot;)"><img referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/8411ed322ced6.svg" /></a></div>
        
        <div class="qrcode" id="qrcode-wechat" style="opacity:0;height:0">
          <img referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=https://panzhenjie.fun/2024/03/01/%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"/>
        </div>
        
      </div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/03/05/Pnpm%E5%88%9D%E7%BA%A7%E6%95%99%E7%A8%8B%E5%92%8C%E5%AE%9E%E8%B7%B5/">PNPM初级教程和实践</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/03/01/Nginx%E5%92%8CPHP%E7%9A%84%E9%85%8D%E7%BD%AE/">Nginx和PHP的配置</a></div></section></div>

<div class="related-wrap" id="related-posts">
    <section class='header'>
      <div class='title cap theme'>您可能感兴趣的文章</div>
    </section>
    <section class='body'>
    <div class="related-posts"><a class="item" href="\2024\03\05\Pnpm初级教程和实践\" title="PNPM初级教程和实践"><span class="title">PNPM初级教程和实践</span></a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body utterances'>
      

<svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="utterances" repo="stephenykk/discussion" issue-term="pathname" theme="preferred-color-scheme"></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">stephenykk</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.27.0">Stellar 1.27.0</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E4%BC%9A%E5%AD%A6%E5%88%B0%E4%BB%80%E4%B9%88"><span class="toc-text">你会学到什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-monorepo-%E9%A3%8E%E6%A0%BC%E7%9A%84%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B7%A5%E7%A8%8B"><span class="toc-text">1、搭建一个 monorepo 风格的脚手架工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E5%A6%82%E4%BD%95%E7%94%A8-Node-js-%E8%BF%90%E8%A1%8C-js"><span class="toc-text">1.1、如何用 Node.js 运行 js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E5%A3%B0%E6%98%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-text">1.2、声明自己的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81npm-link-%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="toc-text">1.3、npm link 的弊端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4%E3%80%81monorepo-%E9%A3%8E%E6%A0%BC%E7%9A%84%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B7%A5%E7%A8%8B"><span class="toc-text">1.4、monorepo 风格的脚手架工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5%E3%80%81%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BF%85%E5%A4%87%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="toc-text">1.5、脚手架必备的模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E6%A8%A1%E5%9D%97"><span class="toc-text">2、命令参数模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E8%8E%B7%E5%8F%96%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0"><span class="toc-text">2.1、获取命令参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E8%AE%BE%E7%BD%AE%E5%AD%90%E5%91%BD%E4%BB%A4"><span class="toc-text">2.2、设置子命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%9D%97"><span class="toc-text">3、用户交互模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%96%87%E4%BB%B6%E5%A4%B9%E6%8B%B7%E8%B4%9D%E6%A8%A1%E5%9D%97"><span class="toc-text">4、文件夹拷贝模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E8%84%9A%E6%89%8B%E6%9E%B6%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84%E5%A4%84%E7%90%86"><span class="toc-text">4.1、脚手架中的路径处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81%E7%9B%AE%E5%BD%95%E5%AE%88%E5%8D%AB"><span class="toc-text">4.2、目录守卫</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D%E6%A8%A1%E5%9D%97"><span class="toc-text">5、文件拷贝模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%8A%A8%E6%80%81%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E6%A8%A1%E5%9D%97"><span class="toc-text">6、动态文件生成模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%E3%80%81mustache-%E7%AE%80%E4%BB%8B"><span class="toc-text">6.1、mustache 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1%E3%80%81%E7%AE%80%E5%8D%95%E7%BB%91%E5%AE%9A"><span class="toc-text">6.1.1、简单绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2%E3%80%81%E7%BB%91%E5%AE%9A%E5%AD%90%E5%B1%9E%E6%80%A7"><span class="toc-text">6.1.2、绑定子属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-3%E3%80%81%E5%BE%AA%E7%8E%AF%E6%B8%B2%E6%9F%93"><span class="toc-text">6.1.3、循环渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-4%E3%80%81%E5%BE%AA%E7%8E%AF%E4%B8%AD%E4%BA%8C%E6%AC%A1%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-text">6.1.4、循环中二次处理数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-5%E3%80%81%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">6.1.5、条件渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-6%E3%80%81%E4%B8%8D%E8%BD%AC%E4%B9%89-HTML-%E6%A0%87%E7%AD%BE"><span class="toc-text">6.1.6、不转义 HTML 标签</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E6%A8%A1%E5%9D%97"><span class="toc-text">7、自动安装依赖模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%8F%91%E5%B8%83%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-text">8、发布和安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text">结语</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.27.0" async></script>

<!-- optional -->

  <script>
  function loadUtterances() {
    const els = document.querySelectorAll("#comments #utterances");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.error(error);
      }
      var script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
      loadUtterances();
  });
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?02fb88f7bf299c2e9c095c0f64f432d8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || null
        }
      });
    })
  }
</script><script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          loop: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script><script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
