
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.27.0" theme-name="Stellar" theme-version="1.27.0">
  
  <meta name="generator" content="Hexo 7.1.1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>Nextjs项目最佳实践 - JKK随笔</title>

  
    <meta name="description" content="原文地址Next.js 项目最佳实践 - 掘金  什么是 Next.js “ Next.js 通过提供所有生产环境需要的功能来给你最佳的开发体验：构建时预渲染，服务端渲染，TypeScript 支持，智能打包，路由预加载，零配置等等 ”  正如上文的介绍，Next.js 是一个非常全面的现代全栈应用构建方案。它包含了非常优雅的 TypeScript 和 React 支持，同时提供了现代应用常见的">
<meta property="og:type" content="article">
<meta property="og:title" content="Nextjs项目最佳实践">
<meta property="og:url" content="https://stephenykk.github.io/2024/03/12/Nextjs%E9%A1%B9%E7%9B%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="JKK随笔">
<meta property="og:description" content="原文地址Next.js 项目最佳实践 - 掘金  什么是 Next.js “ Next.js 通过提供所有生产环境需要的功能来给你最佳的开发体验：构建时预渲染，服务端渲染，TypeScript 支持，智能打包，路由预加载，零配置等等 ”  正如上文的介绍，Next.js 是一个非常全面的现代全栈应用构建方案。它包含了非常优雅的 TypeScript 和 React 支持，同时提供了现代应用常见的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/873f28a181dd4ca1aa0a01012d64ba15~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3c07fe860cc4845bd26343d7f4e22a5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c2dd50ad0674135a01efac48aef7280~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4623d869613e4937b54f2a34f7f4e3bc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34843873fbaa440e8226669c76102587~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c77a98509a3a4ecca17f2fda390f53ed~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d651f6fba112498fb2fd2eefc87e09f2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/764f9341fffe46eeb7416c19ab325756~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d30672b1cd441e3ad8de6cd6844be3f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2401a5b442e436aa1f562c01dce9006~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95cee7221dae40b0b808c659c711b402~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4034b7ea9b88422285bd0dd2a7129912~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ede7bb0dc56d47059496fcc0a123deda~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68f8d8dd53fd4318a2d021e41caa092f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f957175add54a5d88856e37efdd25bc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9c184e6b94b447f914d78a24e2b6ac3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/befa5f520fcf45feb53176af7e9edc75~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
<meta property="article:published_time" content="2024-03-12T04:51:55.000Z">
<meta property="article:modified_time" content="2024-08-29T12:44:10.903Z">
<meta property="article:author" content="stephenykk">
<meta property="article:tag" content="Nextjs">
<meta property="article:tag" content="SSR">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/873f28a181dd4ca1aa0a01012d64ba15~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp">
  
  
  
  <meta name="keywords" content="Nextjs,SSR">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.27.0">

  

  

  
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" no-lazy class="avatar" src="https://avatars.githubusercontent.com/u/7259892?s=400&u=01563911436a79d809f95ca8d1191c8a7ecc6f56&v=4" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">JKK随笔</div><div class="sub normal cap">搬砖工</div><div class="sub hover cap" style="opacity:0"> 但行好事 莫问前程</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/03/12/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8NextJs/"><span class="title">手把手带你入门NextJs</span></a><a class="item title" href="/2024/03/29/%E5%AE%9E%E7%94%A8%E7%9A%84Python%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/"><span class="title">实用的Python编码技巧</span></a><a class="item title" href="/2024/03/13/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3TS2322%E6%8A%A5%E9%94%99/"><span class="title">如何解决TS2322报错</span></a><a class="item title" href="/2024/03/01/%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"><span class="title">前端脚手架开发指南</span></a><a class="item title" href="/2024/03/12/%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9AWebSocket/"><span class="title">十分钟学会WebSocket</span></a><a class="item title" href="/2024/07/31/%E4%B8%80%E6%96%87%E5%90%83%E9%80%8F-React-SSR-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%92%8C%E5%90%8C%E6%9E%84%E5%8E%9F%E7%90%86/"><span class="title">一文吃透 React SSR 服务端渲染和同构原理</span></a><a class="item title" href="/2024/04/10/curl%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/"><span class="title">curl实用教程</span></a><a class="item title" href="/2024/02/28/%5BReact%E8%BF%9B%E9%98%B6%5DAPI%E5%85%A8%E9%9D%A2%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5/"><span class="title">[React进阶]API全面解读与基础实践</span></a><a class="item title" href="/2024/04/12/SVG%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%BE%E8%A7%A3%E7%89%88%EF%BC%89/"><span class="title">SVG快速入门（图解版）</span></a><a class="item title" href="/2024/02/26/SQL%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B/"><span class="title">SQL零基础入门图文教程</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/React/">React</a> <span class="sep"></span> <a class="cap breadcrumb-link" href="/categories/React/Nextjs/">Nextjs</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-03-12T04:51:55.000Z">2024-03-12</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-08-29T12:44:10.903Z">2024-08-29</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>Nextjs项目最佳实践</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><blockquote>
<p>原文地址<a target="_blank" rel="noopener" href="https://juejin.cn/post/7194410416879960125?searchId=20240312124456B7DCE12D607055338A66">Next.js 项目最佳实践 - 掘金</a></p>
</blockquote>
<h2 id="什么是-Next-js"><a href="#什么是-Next-js" class="headerlink" title="什么是 Next.js"></a>什么是 Next.js</h2><blockquote>
<p><em>“ Next.js 通过提供所有生产环境需要的功能来给你最佳的开发体验：构建时预渲染，服务端渲染，TypeScript 支持，智能打包，路由预加载，零配置等等 ”</em></p>
</blockquote>
<p>正如上文的介绍，Next.js 是一个非常全面的现代全栈应用构建方案。它包含了非常优雅的 TypeScript 和 React 支持，同时提供了现代应用常见的需求解决方案，例如：路由，API，PostCSS 工具和代码分割等。</p>
<p>与此同时它也支持静态站点生成（用于可以在任何地方托管的高性能静态 HTML 页面）或者是通过 Vercel &#x2F; AWS 等部署 Node.js 服务来进行数据按需加载的服务端渲染页面</p>
<p>Next.js 已迅速成为 Web 开发领域最抢手的技能之一。本教程旨在充当 <a target="_blank" rel="noopener" href="https://nextjs.org/docs/getting-started" title="https://nextjs.org/docs/getting-started">Next.js 文档</a> 的 “ 实用 ” 延伸，并帮助你使用大量最佳实践来开发项目，这将有利于你在今后对项目实施进一步的扩展。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本教程不是为了替代官方文档，因为官方文档已经写得非常简单易懂了。我强烈推荐你在学习本文之前先大致过一下 <a target="_blank" rel="noopener" href="https://nextjs.org/docs/basic-features/pages" title="https://nextjs.org/docs/basic-features/pages">这一章</a> 的内容，这样你对文中的术语和工具会比较熟悉，他们提供的一些组件与普通 HTML 组件相似，但通常是“更强大”的版本。</p>
<p>我承认其中许多的是严格的并且带有主观色彩的，如果其中任何一个对你没有吸引力，那么在大多数情况下可以简单地跳过这些部分并且应该仍然能够完成本教程而不会遇到太多麻烦</p>
<p>现在，如果你已经准备好了，那就开始学习吧 ！</p>
<h2 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h2><p>我们将使用 TypeScript 模版来创建一个默认的 Next.js 应用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npx create-next-app@latest --typescript nextjs-fullstack-app-template-zn</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> nextjs-fullstack-app-template-zn</span><br><span class="line"></span><br><span class="line">// ESLInt : YES</span><br><span class="line">// `src/` directory : YES</span><br><span class="line">// `app/` directory : NO</span><br></pre></td></tr></table></figure>

<p>首先我们试试这个项目能不能正常运行。我们在这个例子中会使用 yarn ，当然你也可以用 NPM 或其他的工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<p>你可以打开 <a target="_blank" rel="noopener" href="http://localhost:3000/" title="http://localhost:3000/"></a><a target="_blank" rel="noopener" href="http://localhost:3000/" title="http://localhost:3000/">http://localhost:3000/</a> 看到这个 demo 已经成功运行</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/873f28a181dd4ca1aa0a01012d64ba15~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1.png"> 也推荐你运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn build</span><br></pre></td></tr></table></figure>

<p>来确保你的项目能够成功打包。推荐（非必需）关闭开发服务器来运行 Next.js 的构建命令。大多数时候没有问题，但偶尔构建会使你的开发服务器处于需要重新启动的奇怪状态。</p>
<p>构建成功之后你可以在命令行看到这些绿色和白色文字的报告，构建过程是高效的，我们将在开发的过程中尽量保持这样的状态。</p>
<h2 id="引擎锁定"><a href="#引擎锁定" class="headerlink" title="引擎锁定"></a>引擎锁定</h2><p>我们在本项目中使用的 v16 的 Node.js。你可以通过 <code>node --version</code> 检查版本。打开 <code>package.json</code> engines 字段是你指定所使用工具的特定版本的地方。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nextjs-fullstack-app-template-zn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YOUR_NAME&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next build&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next start&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next lint&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@next/font&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13.1.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@types/node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.11.18&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@types/react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.0.27&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@types/react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.0.10&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;next&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13.1.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4.9.4&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;engines&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt;=16.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;yarn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt;=1.22.0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Git-配置"><a href="#Git-配置" class="headerlink" title="Git 配置"></a>Git 配置</h2><p>这将是我们第一次提交到远程仓库的好时机，以确保更改得到备份，并遵循最佳实践将相关更改分组在一个提交中，然后再做新的修改。</p>
<p>默认情况下，你的 Next.js 项目已经初始化了一个 repo。 你可以使用 <code>git status</code> 检查你所在的分支。 它应该会显示类似下面的文案</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch main</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">	modified:   package.json</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">	.npmrc</span><br><span class="line">	.vscode/</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这告诉我们我们在 main 分支上，我们还没有暂存或做出任何提交</p>
<p>让我们提交目前的变更</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -am <span class="string">&quot;feat: project init&quot;</span></span><br></pre></td></tr></table></figure>

<p>第一个命令将在项目目录中添加并暂存所有在 <code>.gitignore</code> 中未被忽略的文件。 第二个将使用我们在 <code>-m</code> 标志之后写的消息来提交当前项目的状态</p>
<p>跳转到你喜欢的 git 托管服务提供商（ 比如 <a target="_blank" rel="noopener" href="https://github.com/" title="https://github.com/">Github</a>）并且创建一个新的仓库来存放你的项目。</p>
<p>现在你已准备好添加仓库的远程源并进行推送。 Github 会在你创建的时候给你准确的说明。 你的语法可能与我的略有不同，具体取决于使用的是 HTTPS 还是 SSH。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin git@github.com:&#123;YOUR_GITHUB_USERNAME&#125;/&#123;YOUR_REPOSITORY_NAME&#125;.git</span><br><span class="line"></span><br><span class="line">git push -u origin &#123;YOUR_BRANCH_NAME&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，从这一点开始，我们将使用 <a target="_blank" rel="noopener" href="https://www.conventionalcommits.org/en/v1.0.0/#summary" title="https://www.conventionalcommits.org/en/v1.0.0/#summary">Conventional Commits</a> 标准，特别是 <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#type" title="https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#type">此处描述</a> 的 Angular 约定</p>
<p>原因与该项目中的许多其他功能一样，只是为所有开发人员设置一个<strong>一致</strong>的标准，以便在为项目做出贡献时最大程度地减少培训时间。我个人不太关心选择什么标准，只要每个人都同意遵循它，才是最重要的。</p>
<p>一致性就是一切 ！！！</p>
<h2 id="代码格式化和质量工具"><a href="#代码格式化和质量工具" class="headerlink" title="代码格式化和质量工具"></a>代码格式化和质量工具</h2><p>为了设定一个标准，供项目的所有贡献者使用，以保持代码风格一致并遵循基本的最佳实践，我们将使用两个工具：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://eslint.org/" title="https://eslint.org/">eslint</a> - 代码规范的最佳实践</li>
<li><a target="_blank" rel="noopener" href="https://prettier.io/" title="https://prettier.io/">prettier</a> - 自动格式化代码文件</li>
</ul>
<h3 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h3><p>我们从 ESLint 开始，它非常简单因为在我们创建 Next.js 项目的时候已经自动安装好并且有了默认配置。</p>
<p>我们仅需要添加少部分额外的配置就可以让它比默认配置更加严格。如果你不同意其中的任何一条规则配置，不用担心，我们可以非常简单的手动关闭这些规则。我们将所有的 ESLint 配置都写在 <code>.eslintrc.json</code> 文件中，这个文件已经存在于我们项目的根目录。</p>
<p><code>.eslintrc.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;next&quot;</span><span class="punctuation">,</span> <span class="string">&quot;next/core-web-vitals&quot;</span><span class="punctuation">,</span> <span class="string">&quot;eslint:recommended&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;globals&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;React&quot;</span><span class="punctuation">:</span> <span class="string">&quot;readonly&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;no-unused-vars&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="string">&quot;after-used&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;argsIgnorePattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^_&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码示例中，我们添加了一些额外的默认值，我们声明 <code>React</code> 将始终被定义，即使我们没有专门导入它，我还添加了个人自定义规则，它允许你为变量添加前缀（带下划线 _） 如果你已声明它们但未在代码中使用它们</p>
<p>我发现当你正在处理一项功能并想准备一些变量以备后面使用但又尚未达到实现它们的地步时，这种情况经常出现</p>
<p>你可以测试一下你的配置通过运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn lint</span><br></pre></td></tr></table></figure>

<p>你会得到类型的提示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">✔ No ESLint warnings or errors</span><br><span class="line">✨  Done <span class="keyword">in</span> 3.48s.</span><br></pre></td></tr></table></figure>

<p>如果你遇到任何错误，那么 ESLint 非常擅长清楚地解释它们是什么。如果遇到你不喜欢的规则，你可以简单的将它从 1（告警）设置成 0（忽略） 来关闭它</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;no-unused-vars&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>让我们在这时候进行一次提交，带上信息 <code>build: configure eslint</code></p>
<h3 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h3><p>prettier 会为我们处理文件的自动格式化。让我们将它添加到项目中</p>
<p>它只需要在开发过程中使用，所以需要添加到 <code>devDependency</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D prettier</span><br></pre></td></tr></table></figure>

<p>同时我也推荐你安装 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" title="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier VS Code 插件</a> ，这样你不用依赖命令行工具就可以在 VS Code 中进行文件格式化。在你的项目中安装和配置它意味着 VSCode 将使用你项目的设置，因此仍然有必要在此处添加它。</p>
<p>我们将在根目录添加两个文件：</p>
<p><code>.prettierrc</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;trailingComma&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tabWidth&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;semi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;singleQuote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这些配置完全由你自行决定什么最适合你的团队和项目</p>
<p><code>.prettierignore</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.yarn</span><br><span class="line">.<span class="built_in">next</span></span><br><span class="line">dist</span><br><span class="line">node_modules</span><br></pre></td></tr></table></figure>

<p>在这个文件中我列了一些目录，我不希望 prettier 在这些目录中浪费任何资源去进行格式化。你也可以使用类似 <code>*.html</code> 这样的方式去忽略你选择的文件类似</p>
<p>现在我们在 <code>package.json</code> 添加新的 script ，然后我们就可以运行 Prettier：</p>
<p><code>package.json</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="string">&quot;scripts: &#123;</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    &quot;</span>prettie<span class="string">r&quot;: &quot;</span>prettier --write .<span class="string">&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>你可以运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn prettier</span><br></pre></td></tr></table></figure>

<p>自动格式化、修复和保存项目中你未忽略的所有文件。 默认情况下，我的格式化程序更新了大约 5 个文件。 你可以在 VS Code 左侧的源代码管理选项卡中的已更改文件列表中看到它们。</p>
<p>让我们在这时候进行一次提交，带上信息 <code>build: implement prettier</code></p>
<h2 id="Git-Hooks"><a href="#Git-Hooks" class="headerlink" title="Git Hooks"></a>Git Hooks</h2><p>在我们开始进行组件开发之前，还有一节是关于配置的。 请记住，如果你要长期构建该项目，你将希望该项目尽可能坚如磐石，尤其是与其他开发人员团队合作时。 花时间在一开始就把它做好是值得的。</p>
<p>我们将使用一个叫做 <a target="_blank" rel="noopener" href="https://typicode.github.io/husky/#/" title="https://typicode.github.io/husky/#/">Husky</a> 的工具</p>
<p>Husky 是一个用于在 git 进程的不同阶段运行脚本的工具，例如 add、commit、push 等。我们希望能够设置某些条件，并且只有在我们的代码满足这些条件时才允许提交和推送之类的事情成功，假设这表明我们的项目质量是可以接受的。</p>
<p>安装 Husky</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D husky</span><br><span class="line"></span><br><span class="line">npx husky install</span><br></pre></td></tr></table></figure>

<p>第二个命令将在你的项目中创建一个 <code>.husky</code> 目录。这就是你的 hooks 存放的地方。确保此目录包含在你的代码仓库中，因为它也适用于其他开发人员，而不仅仅是你自己。</p>
<p>在 <code>package.json</code> 文件中添加 script</p>
<p><code>package.json</code></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="string">&quot;scripts: &#123;</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    &quot;</span>prepare<span class="string">&quot;: &quot;</span>husky install<span class="string">&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>这将确保在其他开发人员运行该项目时自动安装 Husky</p>
<p>创建一个 hook</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky <span class="keyword">add</span> .husky<span class="operator">/</span>pre<span class="operator">-</span><span class="keyword">commit</span> &quot;yarn lint&quot;</span><br></pre></td></tr></table></figure>

<p>上面说为了让我们的提交成功，<code>yarn lint</code> 必须首先运行并成功。 在这种情况下，” 成功 ”意味着没有错误。 它将允许你有告警（请记住，在 ESLint 配置中，设置 1 是警告，设置 2 是错误）</p>
<p>让我们在这时候进行一次提交，带上信息 <code>ci: implement husky</code> 。如果所有设置都完成，在你进行提交之前就会运行 lint script</p>
<p>让我们再添加一个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/pre-push <span class="string">&quot;yarn build&quot;</span></span><br></pre></td></tr></table></figure>

<p>以上确保我们只有在代码构建成功的时候才可以将代码推送到远程仓库中。 这似乎是一个相当合理的条件，不是吗？ 通过提交此更改并尝试推送来随意测试它。</p>
<p>最后，我们将再添加一个工具。 到目前为止，我们一直在遵循所有提交消息的标准约定，让我们确保团队中的每个人都遵循它们（包括我们自己！）。 我们可以为我们的提交消息添加一个 linter：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="keyword">add</span> <span class="operator">-</span>D <span class="variable">@commitlint</span><span class="operator">/</span>config<span class="operator">-</span>conventional <span class="variable">@commitlint</span><span class="operator">/</span>cli</span><br></pre></td></tr></table></figure>

<p>要配置它，我们将使用一组标准默认值，但我喜欢将该列表显式包含在 commitlint.config.js 文件中，因为我有时会忘记可用的前缀：</p>
<p><code>commitlint.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build: 影响构建系统或外部依赖项的更改（示例范围：gulp、broccoli、npm）</span></span><br><span class="line"><span class="comment">// ci: 更改我们的 CI 配置文件和脚本（示例范围：Travis、Circle、BrowserStack、SauceLabs）</span></span><br><span class="line"><span class="comment">// docs: 文档修改</span></span><br><span class="line"><span class="comment">// feat: 一个新的功能</span></span><br><span class="line"><span class="comment">// fix: 一个 bug 修复</span></span><br><span class="line"><span class="comment">// perf: 提升性能的代码修改</span></span><br><span class="line"><span class="comment">// refactor: 既不修复错误也不添加功能的代码更改</span></span><br><span class="line"><span class="comment">// style: 不影响代码含义的更改（空格、格式、缺少分号等）</span></span><br><span class="line"><span class="comment">// test: 添加缺失的测试或更正现有测试</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">extends</span>: [<span class="string">&quot;@commitlint/config-conventional&quot;</span>],</span><br><span class="line">    <span class="attr">rules</span>: &#123;</span><br><span class="line">        <span class="string">&quot;body-leading-blank&quot;</span>: [<span class="number">1</span>, <span class="string">&quot;always&quot;</span>],</span><br><span class="line">        <span class="string">&quot;body-max-line-length&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>, <span class="number">100</span>],</span><br><span class="line">        <span class="string">&quot;footer-leading-blank&quot;</span>: [<span class="number">1</span>, <span class="string">&quot;always&quot;</span>],</span><br><span class="line">        <span class="string">&quot;footer-max-line-length&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>, <span class="number">100</span>],</span><br><span class="line">        <span class="string">&quot;header-max-length&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>, <span class="number">100</span>],</span><br><span class="line">        <span class="string">&quot;scope-case&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>, <span class="string">&quot;lower-case&quot;</span>],</span><br><span class="line">        <span class="string">&quot;subject-case&quot;</span>: [</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="string">&quot;never&quot;</span>,</span><br><span class="line">            [<span class="string">&quot;sentence-case&quot;</span>, <span class="string">&quot;start-case&quot;</span>, <span class="string">&quot;pascal-case&quot;</span>, <span class="string">&quot;upper-case&quot;</span>],</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;subject-empty&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],</span><br><span class="line">        <span class="string">&quot;subject-full-stop&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>, <span class="string">&quot;.&quot;</span>],</span><br><span class="line">        <span class="string">&quot;type-case&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>, <span class="string">&quot;lower-case&quot;</span>],</span><br><span class="line">        <span class="string">&quot;type-empty&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],</span><br><span class="line">        <span class="string">&quot;type-enum&quot;</span>: [</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="string">&quot;always&quot;</span>,</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&quot;build&quot;</span>,</span><br><span class="line">                <span class="string">&quot;chore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;ci&quot;</span>,</span><br><span class="line">                <span class="string">&quot;docs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;feat&quot;</span>,</span><br><span class="line">                <span class="string">&quot;fix&quot;</span>,</span><br><span class="line">                <span class="string">&quot;perf&quot;</span>,</span><br><span class="line">                <span class="string">&quot;refactor&quot;</span>,</span><br><span class="line">                <span class="string">&quot;revert&quot;</span>,</span><br><span class="line">                <span class="string">&quot;style&quot;</span>,</span><br><span class="line">                <span class="string">&quot;test&quot;</span>,</span><br><span class="line">                <span class="string">&quot;translation&quot;</span>,</span><br><span class="line">                <span class="string">&quot;security&quot;</span>,</span><br><span class="line">                <span class="string">&quot;changeset&quot;</span>,</span><br><span class="line">            ],</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后使用 Husky 启用 commitlint：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/commit-msg <span class="string">&#x27;npx --no -- commitlint --edit &quot;$1&quot;&#x27;</span></span><br><span class="line"><span class="comment">## 有的时候上述的命令会在某些命令行环境失效，也可以试试下面的命令</span></span><br><span class="line">npx husky add .husky/commit-msg \&quot;npx --no -- commitlint --edit <span class="string">&#x27;$1&#x27;</span>\&quot;</span><br><span class="line"><span class="comment">## 或者</span></span><br><span class="line">npx husky add .husky/commit-msg <span class="string">&quot;npx --no -- commitlint --edit <span class="variable">$1</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>我现在要使用消息 <code>ci: implement commitlint</code> 创建一个新的提交</p>
<p>你可以在下面的屏幕截图中看到此设置的最终结果，希望你的结果与此类似：</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3c07fe860cc4845bd26343d7f4e22a5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="2.png"></p>
<p>如果提交信息格式不正确的话，则会报错</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c2dd50ad0674135a01efac48aef7280~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="3.png"></p>
<h2 id="VS-Code-配置"><a href="#VS-Code-配置" class="headerlink" title="VS Code 配置"></a><strong>VS Code 配置</strong></h2><p>现在我们已经实现了 ESLint 和 Prettier，我们可以利用一些便利的 VS Code 功能让它们自动运行。</p>
<p>在项目的根目录中创建一个名为 .vscode 的目录和一个名为 settings.json 的文件。 这将是一个覆盖已安装 VS 代码默认设置的值列表。</p>
<p>我们想要将它们放在项目文件夹中的原因是我们可以设置仅适用于该项目的特定设置，并且我们可以通过将它们包含在代码仓库中来与我们团队的其他成员共享它们。</p>
<p>在 settings.json 中，我们将添加以下值</p>
<p><code>.vscode/settings.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;editor.defaultFormatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esbenp.prettier-vscode&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.formatOnSave&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.codeActionsOnSave&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;source.fixAll&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;source.organizeImports&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>以上将告诉 VS Code 使用你的 Prettier 扩展作为默认格式化程序（如果你愿意，可以手动覆盖另一个）并在每次保存时自动格式化你的文件并组织你的导入语句</p>
<p>非常方便的东西，你不再需要考虑的另一件事，因此可以专注于重要的事情，例如解决业务问题</p>
<p>让我们在这时候进行一次提交，带上信息 <code>build: implement vscode project settings</code></p>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>让我们设置一个方便的环境来调试我们的应用程序，以防我们在开发过程中遇到任何问题。</p>
<p>在 <code>.vscode</code> 目录下创建 <code>launch.json</code> 文件</p>
<p><code>launch.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Next.js: debug server-side&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-terminal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run dev&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Next.js: debug client-side&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pwa-chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;http://localhost:3000&gt;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Next.js: debug full stack&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-terminal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;console&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integratedTerminal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;serverReadyAction&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;started server on .+, url: (https?://.+)&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;uriFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;%s&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;debugWithChrome&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>使用该脚本你可以选择三种调试方式。单击 VS Code 左侧的小 “错误和播放图标” 或按 <code>Ctrl + Shift + D</code> 访问调试菜单。你可以选择要运行的脚本并使用启动&#x2F;停止按钮启动 &#x2F; 停止它</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4623d869613e4937b54f2a34f7f4e3bc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="4.png"></p>
<p>除此之外，或者如果你没有使用 VS Code，我们也可以在项目中设置一些有用的调试脚本</p>
<p>首先，我们将安装 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/cross-env" title="https://www.npmjs.com/package/cross-env">cross-env</a> ， 如果你有同事在不同的环境（Windows、Linux、Mac 等）上工作，则有必要设置环境变量。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="keyword">add</span> <span class="operator">-</span>D <span class="keyword">cross</span><span class="operator">-</span>env</span><br></pre></td></tr></table></figure>

<p>安装完这个包之后，我们可以更新下 <code>package.json</code> 文件中的 <code>dev</code> 脚本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_OPTIONS=&#x27;--inspect&#x27; next dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这将允许你在开发模式下工作时在浏览器中记录服务器数据，从而更容易调试问题。</p>
<p>在这个阶段，我将创建一个新的提交 <code>build: add debugging configuration</code></p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>本节现在将介绍在我们的项目中设置文件夹结构。这是许多人都会有非常强烈意见的话题之一，并且有充分的理由！从长远来看，目录结构确实可以在项目失控时成就或破坏项目，尤其是当团队成员不得不花费不必要的时间来猜测将东西放在哪里（或找到东西）时。</p>
<p>我个人喜欢采用相当简单的方法，基本上以类的 model &#x2F; view 将事物分开。我们将使用三个主要文件夹</p>
<blockquote>
<p>PS: 原文没有 src 目录，我个人喜欢用 src 目录，所以加了 src 根目录</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/components</span><br><span class="line">/lib</span><br><span class="line">/pages</span><br></pre></td></tr></table></figure>

<ul>
<li>components - 组成应用程序的各个 UI 组件将位于此处</li>
<li>lib - 业务 &#x2F; 应用程序&#x2F; 领域 逻辑将存在于此</li>
<li>pages - 项目的实际 路由&#x2F; 页面</li>
</ul>
<p>除此之外，我们还会有其他目录来支持该项目，但构成我们的应用程序的几乎所有内容的核心都将位于这三个目录中</p>
<p>在 <code>components</code> 中，我们将有子目录，这些子目录将相似类型的组件组合在一起。你可以使用你喜欢的任何方法来执行此操作。 我过去经常使用 MUI 库，所以我倾向于遵循他们在<a target="_blank" rel="noopener" href="https://mui.com/material-ui/getting-started/installation/" title="https://mui.com/material-ui/getting-started/installation/">文档</a>中用于组件的相同组织</p>
<p>例如输入框、导航、工具方法、布局等。</p>
<p>你不需要提前创建这些目录并将它们留空。我会在构建组件时随手创建它们</p>
<p>本节旨在解释我将如何设置这个项目，你可以选择许多其他方式来组织你的项目，我鼓励你选择最适合你和团队的方式。</p>
<p>这里我再使用 <code>feat: create directory structure</code> 创建一个提交</p>
<h2 id="添加-Storybook"><a href="#添加-Storybook" class="headerlink" title="添加 Storybook"></a>添加 Storybook</h2><p>我们可以使用的一种很棒的现代工具叫做 <a target="_blank" rel="noopener" href="https://storybook.js.org/" title="https://storybook.js.org/">Storybook</a></p>
<p>Storybook 为我们提供了一个环境来展示和测试我们在我们正在使用它们的应用程序之外构建的 React 组件。它是将开发人员与设计人员联系起来并能够根据设计要求验证我们开发的组件的外观和功能的好工具</p>
<p>请注意，Storybook 是一种可视化测试工具，稍后我们将引入其他工具来进行功能单元测试和端到端测试</p>
<p>学习如何使用 Storybook 的最佳方式是安装并试用它！</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sb <span class="keyword">init</span> --builder webpack5</span><br></pre></td></tr></table></figure>

<p>我们将使用 webpack5 版本来与最新版本的 webpack 保持同步（我不确定为什么它仍然不是默认版本。也许在你使用本教程时已经是了）。</p>
<p>当 Storybook 安装时，它会自动检测有关项目的很多信息，比如它是一个 React 应用程序，以及正在使用的其他工具。 它应该兼容好所有配置本身。</p>
<p>如果你收到有关 eslintPlugin 的提示，你可以选择“是”。 不过，我们将手动配置它，所以如果你收到一条消息说它没有自动配置，请不要担心。</p>
<p>打开 <code>eslintrc.json</code> 文件并更新它</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;plugin:storybook/recommended&quot;</span><span class="punctuation">,</span> <span class="comment">// 新加入</span></span><br><span class="line">        <span class="string">&quot;next&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;next/core-web-vitals&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;eslint:recommended&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;globals&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;React&quot;</span><span class="punctuation">:</span> <span class="string">&quot;readonly&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 新加入</span></span><br><span class="line">    <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*.stories.@(ts|tsx|js|jsx|mjs|cjs)&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="comment">// example of overriding a rule</span></span><br><span class="line">                <span class="attr">&quot;storybook/hierarchy-separator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;no-unused-vars&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="string">&quot;after-used&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;argsIgnorePattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^_&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>我添加了 <code>// 新加入</code> 来标记 Storybook 特定的两个新部分和行。</p>
<p>我们注意到，Storybook 也已将 &#x2F;stories 目录添加到项目中，其中包含许多示例。如果你是 Storybook 的新手，我强烈建议你通读它们并将它们留在那里，直到你能够脱离模板自如地创建自己的示例。</p>
<p>在我们运行它之前，我们需要确保我们使用的是 webpack5。 将以下内容添加到 <code>package.json</code> 文件中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;resolutions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br></pre></td></tr></table></figure>

<p>确保 webpack5 已经被安装</p>
<p>接下来更新 <code>.storybook/main.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">stories</span>: [<span class="string">&quot;../**/*.stories.mdx&quot;</span>, <span class="string">&quot;../**/*.stories.@(js|jsx|ts|tsx)&quot;</span>],</span><br><span class="line">    <span class="comment">/** 暴露 public 目录给到 stotrybook，作为静态资源目录 */</span></span><br><span class="line">    <span class="attr">staticDirs</span>: [<span class="string">&quot;../public&quot;</span>],</span><br><span class="line">    <span class="attr">addons</span>: [</span><br><span class="line">        <span class="string">&quot;@storybook/addon-links&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@storybook/addon-essentials&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@storybook/addon-interactions&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">framework</span>: <span class="string">&quot;@storybook/react&quot;</span>,</span><br><span class="line">    <span class="attr">core</span>: &#123;</span><br><span class="line">        <span class="attr">builder</span>: <span class="string">&quot;@storybook/builder-webpack5&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在这里，我们更改了 stories 文件的模式，以便它可以在我们的组件（或其他）目录中选取任何 .stories 文件。</p>
<p>我们暴露了 Next.js 的 “public” 目录作为 Storybook 的静态资源目录，这样我们就可以在 Storybook 中测试类似图片，视频等资源了</p>
<p>最后，在我们运行 Storybook 本身之前，让我们在 <code>.storybook/preview.js</code> 中添加一些有用的值。 这是我们控制 stories 渲染方式默认值的文件。</p>
<p><code>storybook/preview.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;../styles/globals.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">NextImage</span> <span class="keyword">from</span> <span class="string">&quot;next/image&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BREAKPOINTS_INT</span> = &#123;</span><br><span class="line">    <span class="attr">xs</span>: <span class="number">375</span>,</span><br><span class="line">    <span class="attr">sm</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">md</span>: <span class="number">900</span>,</span><br><span class="line">    <span class="attr">lg</span>: <span class="number">1200</span>,</span><br><span class="line">    <span class="attr">xl</span>: <span class="number">1536</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> customViewports = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="variable constant_">BREAKPOINTS_INT</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">[key, val], idx</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            key,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: key,</span><br><span class="line">                <span class="attr">styles</span>: &#123;</span><br><span class="line">                    <span class="attr">width</span>: <span class="string">`<span class="subst">$&#123;val&#125;</span>px`</span>,</span><br><span class="line">                    <span class="attr">height</span>: <span class="string">`<span class="subst">$&#123;(idx + <span class="number">5</span>) * <span class="number">10</span>&#125;</span>vh`</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ];</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许 Storybook 处理 Next 的 &lt;Image&gt; 组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OriginalNextImage</span> = <span class="title class_">NextImage</span>.<span class="property">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">NextImage</span>, <span class="string">&quot;default&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">OriginalNextImage</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">unoptimized</span> /&gt;</span></span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> parameters = &#123;</span><br><span class="line">    <span class="attr">actions</span>: &#123; <span class="attr">argTypesRegex</span>: <span class="string">&quot;^on[A-Z].*&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">controls</span>: &#123;</span><br><span class="line">        <span class="attr">matchers</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="regexp">/(background|color)$/i</span>,</span><br><span class="line">            <span class="attr">date</span>: <span class="regexp">/Date$/</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">viewport</span>: &#123; <span class="attr">viewports</span>: customViewports &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面有几个属于个人喜好，大家可以随意配置。请务必设置默认断点以匹配应用中对你重要的任何内容。我们还添加了一个处理方法，以便 Storybook 可以处理 Next 的 组件而不会崩溃。</p>
<p>现在我们准备来测试一下，运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn storybook</span><br></pre></td></tr></table></figure>

<p>如果一切顺利，将在控制台中看到一条消息，如下所示：</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34843873fbaa440e8226669c76102587~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="5.png"></p>
<p>然后你可以通过 <a target="_blank" rel="noopener" href="http://localhost:6006/" title="http://localhost:6006/">http://localhost:6006</a> 访问到</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c77a98509a3a4ecca17f2fda390f53ed~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="6.png"></p>
<p>如果你以前从未使用过这些示例，我希望你尝试并熟悉这些示例。</p>
<p>在这个阶段，我再创建一个提交 <code>build: implement storybook</code></p>
<h2 id="创建一个组件模版"><a href="#创建一个组件模版" class="headerlink" title="创建一个组件模版"></a>创建一个组件模版</h2><p>是时候将我们已经完成的所有配置放在一起，看看如何使用我们为自己设定的标准来创建和实现我们的第一个组件了</p>
<p>我们将创建一个简单的卡片。创建如下的目录</p>
<p><code>/src/components/template/base</code></p>
<p>在这个目录中创建 <code>BaseTemplate.tsx</code> 。这将遵循文件名的标准模式，该模式与指向它的目录相匹配。例如，这允许我们在卡片目录中拥有其他类型的卡片，如 <code>PhotoCard</code> 或 <code>TextCard</code> 等。</p>
<p><code>BaseTemplate.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IBaseTemplate</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BaseTemplate</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IBaseTemplate</span>&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">BaseTemplate</span>;</span><br></pre></td></tr></table></figure>

<p>我们的每一个组件都将遵循这个确切的结构。即使它不使用 props，它仍然会为组件导出一个空的 props 接口。这样做的原因是它将允许我们在许多组件和文件中复制这个精确的结构，并使用相同的模式交换组件，并且只查找&#x2F;替换组件的名称。</p>
<p>当你开始使用 stories 和 mock props 时，就会明白为所有组件文件维护一致的命名方案和界面是多么方便和强大。</p>
<p>这其中就遵循了我们之前提及到的 <strong>一致性就是一切</strong></p>
<p>接下来我们会为组件创建样式文件。我个人更喜欢将样式文件存放在各个组件的文件夹中</p>
<p><code>BaseTemplate.module.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.component</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作为顶级样式，将在你的组件目录中放置标准空模板。你可以像如下一样更新 <code>BaseTemplate</code> 文件</p>
<p><code>BaseTemplate.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./BaseTemplate.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IBaseTemplate</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BaseTemplate</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IBaseTemplate</span>&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">BaseTemplate</span>;</span><br></pre></td></tr></table></figure>

<p>现在，我们拥有了一个干净的样式模版</p>
<p>现在让我们为组件添加一个实验性质的 prop</p>
<p><code>BaseTemplate.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./BaseTemplate.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IBaseTemplate</span> &#123;</span><br><span class="line">    <span class="attr">sampleTextProp</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BaseTemplate</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IBaseTemplate</span>&gt; = <span class="function">(<span class="params">&#123; sampleTextProp &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span>&#123;sampleTextProp&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">BaseTemplate</span>;</span><br></pre></td></tr></table></figure>

<p>对于每一个我们创建的组件，我们希望能够快速的方便的在不同环境（比如在 storybook，或者在 app 内，或者在我们编写的单元测试中）中去测试它。快速访问数据来渲染组件将会很方便。</p>
<p>让我们创建一个文件来存储这个组件的模拟数据，这些模拟数据是给后续测试使用的。</p>
<p><code>BaseTemplate.mocks.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">IBaseTemplate</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./BaseTemplate&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">base</span>: <span class="title class_">IBaseTemplate</span> = &#123;</span><br><span class="line">    <span class="attr">sampleTextProp</span>: <span class="string">&quot;Hello world!&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mockBaseTemplateProps = &#123;</span><br><span class="line">    base,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个结构看起来有点点复杂，但很快我们将看到它的优点。我使用十分见名知意的一致命名模式，所以这个模板很容易复制并粘贴到你创建的每个新组件。</p>
<p>现在我们为这个组件创建一个 story</p>
<p><code>BaseTemplate.stories.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ComponentStory</span>, <span class="title class_">ComponentMeta</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@storybook/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">BaseTemplate</span>, &#123; <span class="title class_">IBaseTemplate</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./BaseTemplate&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mockBaseTemplateProps &#125; <span class="keyword">from</span> <span class="string">&quot;./BaseTemplate.mocks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;templates/BaseTemplate&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">BaseTemplate</span>,</span><br><span class="line">    <span class="attr">argTypes</span>: &#123;&#125;,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="title class_">ComponentMeta</span>&lt;<span class="keyword">typeof</span> <span class="title class_">BaseTemplate</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Template</span>: <span class="title class_">ComponentStory</span>&lt;<span class="keyword">typeof</span> <span class="title class_">BaseTemplate</span>&gt; = <span class="function">(<span class="params">args</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">BaseTemplate</span> &#123;<span class="attr">...args</span>&#125; /&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Base</span> = <span class="title class_">Template</span>.<span class="title function_">bind</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Base</span>.<span class="property">args</span> = &#123;</span><br><span class="line">    ...mockBaseTemplateProps.<span class="property">base</span>,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="title class_">IBaseTemplate</span>;</span><br></pre></td></tr></table></figure>

<p>我不会告诉你每一个 story 文件的具体细节，对你来说，做好的学习资源是 Storybook 的官方文档。</p>
<p>这里目标是创建一个容易复制粘贴的一致性的组件模版，以供组件进行开发和测试</p>
<p>现在测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn storybook</span><br></pre></td></tr></table></figure>

<p>如果一切顺利，你将会看到下面的界面（如果有问题，我建议你再重新检查一下之前的配置正不正确）</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d651f6fba112498fb2fd2eefc87e09f2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="7.png"></p>
<p>现在我们开始创建更多文件，最好养成在提交之前运行 <code>yarn lint</code> 的习惯，以确保一切都是干净的并准备就绪。我在这里再创建一个提交 <code>build: create BaseTemplate component</code></p>
<h2 id="使用组件模版"><a href="#使用组件模版" class="headerlink" title="使用组件模版"></a>使用组件模版</h2><p>既然我们已经有了组件模版，接下来我们就创建一个真实的组件</p>
<p>创建 <code>components/cards</code> 目录。然后将 <code>templates</code> 目录下的 <code>base</code> 文件夹拷贝到 <code>cards</code> 下面，然后再将 <code>base</code> 重命名为 <code>cat</code> 。我们将创建一个 <code>CatCard</code> 。重命名每个文件以匹配。 完成后应该是这样的：</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/764f9341fffe46eeb7416c19ab325756~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="8.png"></p>
<p>然后在 <code>components/cards/cat</code> 目录下，全局将 <code>BaseTemplate</code> 替换为 <code>CatCard</code> ，如下</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d30672b1cd441e3ad8de6cd6844be3f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="9.png"></p>
<p>现在我们准备开始工作，我们已经有了一个干净的预生成的模版，其中已经为我们的 Card 组件包含了 story 文件和模拟数据文件。相当的方便！让我们开始开发 Card 组件吧：</p>
<p><code>CatCard.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Image</span> <span class="keyword">from</span> <span class="string">&quot;next/image&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./CatCard.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ICatCard</span> &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">body</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">author</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">time</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CatCard</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">ICatCard</span>&gt; = <span class="function">(<span class="params">&#123; tag, title, body, author, time &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.card&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.card__header&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Image</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">src</span>=<span class="string">&quot;/time-cat.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">alt</span>=<span class="string">&quot;card__image&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">className</span>=<span class="string">&#123;styles.card__image&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">width</span>=<span class="string">&quot;600&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">height</span>=<span class="string">&quot;400&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.card__body&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">styles.tag</span>&#125; $&#123;<span class="attr">styles</span>[&quot;<span class="attr">tag-blue</span>&quot;]&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#123;tag&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;body&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.card__footer&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.user&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Image</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">src</span>=<span class="string">&quot;&lt;https://i.pravatar.cc/40?img=3&gt;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">alt</span>=<span class="string">&quot;user__image&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">className</span>=<span class="string">&#123;styles.user__image&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">width</span>=<span class="string">&quot;40&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">height</span>=<span class="string">&quot;40&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.user__info&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">h5</span>&gt;</span>&#123;author&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">small</span>&gt;</span>&#123;time&#125;<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    );</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default CatCard;</span></span><br></pre></td></tr></table></figure>

<p>设置样式</p>
<p><code>CatCard.module.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> url(<span class="string">&quot;&lt;https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&amp;display=swap&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> * &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card__image</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&quot;Quicksand&quot;</span>, sans-serif;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">clamp</span>(<span class="number">20rem</span>, <span class="built_in">calc</span>(<span class="number">20rem</span> + <span class="number">2vw</span>), <span class="number">22rem</span>);</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0.1rem</span> <span class="number">1rem</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ece9e6</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to right, <span class="number">#ffffff</span>, <span class="number">#ece9e6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card__body</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tag</span> &#123;</span><br><span class="line">    <span class="attribute">align-self</span>: flex-start;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.25em</span> <span class="number">0.75em</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.75rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tag-blue</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#56ccf2</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to bottom, <span class="number">#2f80ed</span>, <span class="number">#56ccf2</span>);</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fafafa</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card__body</span> <span class="selector-tag">h4</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">text-transform</span>: capitalize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card__footer</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user__image</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user__info</span> &gt; small &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置模拟数据</p>
<p><code>CatCard.mocks.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ICatCard</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./CatCard&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">base</span>: <span class="title class_">ICatCard</span> = &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&quot;Felines&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">`What&#x27;s new in Cats`</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="string">&quot;Lorem ipsum dolor sit amet consectetur adipisicing elit. Sequi perferendis molestiae non nemo doloribus. Doloremque, nihil! At ea atque quidem!&quot;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&quot;Alex&quot;</span>,</span><br><span class="line">    <span class="attr">time</span>: <span class="string">&quot;2h ago&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mockCatCardProps = &#123;</span><br><span class="line">    base,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>注意这里从项目的 public 目录用了一张 🐱  的照片(&#x2F;time-cat.jpg)，你可以从项目的仓库中找到它</p>
<p><code>CatCard.stories</code> 的修改就是需要将 story 的 title 从 <code>templates/CatCard</code> 改为 <code>cards/CatCard</code></p>
<p>我们需要更新 <code>next.config.js</code>，因为我们正在使用一个没有明确声明允许的域（对于头像）。 只需将配置文件更新为如下所示</p>
<p><code>next.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;next&#x27;).NextConfig</span>&#125; */</span></span><br><span class="line"><span class="keyword">const</span> nextConfig = &#123;</span><br><span class="line">    <span class="attr">reactStrictMode</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">images</span>: &#123;</span><br><span class="line">        <span class="attr">domains</span>: [<span class="string">&quot;i.pravatar.cc&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = nextConfig;</span><br></pre></td></tr></table></figure>

<p>或者，你可以将头像图像放在 public 目录中，但为了学习使用外部域的过程，我们将保留此设置。</p>
<p>现在运行 Storybook，如果你足够幸运，你将会看到</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2401a5b442e436aa1f562c01dce9006~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="10.png"></p>
<p>这个组件可以很方便的放置在实际项目中的任何位置。在短期内测试时使用 <code>mock</code> prop，并在准备好后更换为真实 prop</p>
<p><code>pages/index.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">NextPage</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Head</span> <span class="keyword">from</span> <span class="string">&quot;next/head&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Image</span> <span class="keyword">from</span> <span class="string">&quot;next/image&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CatCard</span> <span class="keyword">from</span> <span class="string">&quot;../components/cards/cat/CatCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mockCatCardProps &#125; <span class="keyword">from</span> <span class="string">&quot;../components/cards/cat/CatCard.mocks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span>: <span class="title class_">NextPage</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">title</span>&gt;</span>Create Next App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">meta</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">name</span>=<span class="string">&quot;description&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">content</span>=<span class="string">&quot;Generated by create next app&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/favicon.ico&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    Welcome to <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;https://nextjs.org&gt;&quot;</span>&gt;</span>Next.js!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:</span> &quot;<span class="attr">flex</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">CatCard</span> &#123;<span class="attr">...mockCatCardProps.base</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">CatCard</span> &#123;<span class="attr">...mockCatCardProps.base</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">CatCard</span> &#123;<span class="attr">...mockCatCardProps.base</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">CatCard</span> &#123;<span class="attr">...mockCatCardProps.base</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">href</span>=<span class="string">&quot;&lt;https://vercel.com?utm_source=create-next-app&amp;utm_medium=default-template&amp;utm_campaign=create-next-app&gt;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">rel</span>=<span class="string">&quot;noopener noreferrer&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                &gt;</span></span></span><br><span class="line"><span class="language-xml">                    Powered by&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Image</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">src</span>=<span class="string">&quot;/vercel.svg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">alt</span>=<span class="string">&quot;Vercel Logo&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">width</span>=<span class="string">&#123;72&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">height</span>=<span class="string">&#123;16&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    );</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default Home;</span></span><br></pre></td></tr></table></figure>

<p>运行如下命令查看界面样式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95cee7221dae40b0b808c659c711b402~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="11.png"></p>
<h2 id="添加自定义文档"><a href="#添加自定义文档" class="headerlink" title="添加自定义文档"></a>添加自定义文档</h2><p>虽然在这个阶段没有必要，但你可能希望对应用的 <code>&lt;head&gt;</code> 中的内容进行更细粒度的控制。在<code>pages</code>目录中创建自定义 <code>_document.tsx</code></p>
<p><code>pages/_document.tsx</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Document</span>, &#123; <span class="title class_">Head</span>, <span class="title class_">Html</span>, <span class="title class_">Main</span>, <span class="title class_">NextScript</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next/document&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDocument</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Document</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">link</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">rel</span>=<span class="string">&quot;preconnect&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">href</span>=<span class="string">&quot;&lt;https://fonts.googleapis.com&gt;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preconnect&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&lt;https://fonts.gstatic.com&gt;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">link</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">href</span>=<span class="string">&quot;&lt;https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&amp;display=swap&gt;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Main</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">NextScript</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        );</span></span><br><span class="line"><span class="language-xml">    &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default MyDocument;</span></span><br></pre></td></tr></table></figure>

<p><em>请注意，我已经移除了 <code>components/cards/cat/CatCard.module.css</code> 中的 <code>@import</code> 字体，并且把 google 字体放在这里进行预加载</em></p>
<p>您需要在 <code>&lt;head&gt;</code> 元素中执行或自定义的任何其他操作现在都可以在此文件中完成。</p>
<p>请注意，此 <code>&lt;Head&gt;</code> 与从 <code>next/head</code> 导入的不同。 它们将一起工作，而这个仅用于你希望在每个页面上加载的数据。</p>
<p>更多的关于自定义 <code>_document</code> ，可以查看这个<a target="_blank" rel="noopener" href="https://nextjs.org/docs/advanced-features/custom-document" title="https://nextjs.org/docs/advanced-features/custom-document">文档</a></p>
<h2 id="添加-Layouts"><a href="#添加-Layouts" class="headerlink" title="添加 Layouts"></a>添加 <strong>Layouts</strong></h2><p>Layouts 是 Next.js 中的重要概念。他们协助我们管理页面间的状态。对于本节，我们将使用与<a target="_blank" rel="noopener" href="https://github.com/vercel/next.js/tree/canary/examples/layout-component" title="https://github.com/vercel/next.js/tree/canary/examples/layout-component">官方示例</a> 中提供的相同的基本模板，并简单地对其进行自定义以适合我们的项目。</p>
<p>在 <code>components</code> 中创建新的目录 <code>layouts</code> 。我们将复制两次 <code>templates/case</code> 目录。一个叫做 <code>primary</code> ，另一个叫做 <code>sidebar</code> 。如下图所示</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4034b7ea9b88422285bd0dd2a7129912~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="12.png"></p>
<p>在每个文件中对 <code>BaseTemplate</code> 进行区分大小写的查找&#x2F;替换，并分别替换为 <code>PrimaryLayout</code> 和 <code>SidebarLayout</code>。 如果你在这一步有遇到困难，可以直接参考这个<a target="_blank" rel="noopener" href="https://github.com/zidanDirk/nextjs-fullstack-app-template-zn" title="https://github.com/zidanDirk/nextjs-fullstack-app-template-zn">仓库的结构</a></p>
<p>更新  <code>PrimaryLayout.tsx</code> 和  <code>PrimaryLayout.module.css</code> 文件：</p>
<p><code>components/layouts/primary/PrimaryLayout.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Head</span> <span class="keyword">from</span> <span class="string">&quot;next/head&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./PrimaryLayout.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IPrimaryLayout</span> <span class="keyword">extends</span> <span class="title class_">React</span>.<span class="title class_">ComponentPropsWithoutRef</span>&lt;&quot;div&quot;&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PrimaryLayout</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">IPrimaryLayout</span>&gt; = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">title</span>&gt;</span>Primary Layout Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">main</span> <span class="attr">className</span>=<span class="string">&#123;styles.main&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PrimaryLayout</span>;</span><br></pre></td></tr></table></figure>

<p><code>components/layouts/primary/PrimaryLayout.module.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">calc</span>(<span class="number">100vh</span> - <span class="number">64px</span>);</span><br><span class="line">    <span class="attribute">background-color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.main</span> &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是 sidebar</p>
<p><code>components/layouts/sidebar/SidebarLayout.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&quot;next/link&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;./SidebarLayout.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ISidebarLayout</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SidebarLayout</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">ISidebarLayout</span>&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">className</span>=<span class="string">&#123;styles.nav&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">className</span>=<span class="string">&#123;styles.input&#125;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Search...&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/contact&quot;</span>&gt;</span>Contact<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">SidebarLayout</span>;</span><br></pre></td></tr></table></figure>

<p><code>components/layouts/sidebar/SidebarLayout.module.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">250px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fafafa</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">8px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">    <span class="attribute">letter-spacing</span>: <span class="number">0.025em</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.125s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eaeaea</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">32px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">28px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在这些文件都创建好了，我们需要使用他们。我们将更新我们的主页并创建另一个名为 <code>about.tsx</code> 的页面来展示如何使用共享 layouts 并在页面之间保持组件状态。</p>
<p>首先，我们需要添加一个类型来扩展默认的 NextPage 接口，因为出于某种原因它不包含开箱即用的 <code>getLayout</code> 函数。</p>
<p>创建一个自定义类型文件，它将为我们处理此问题提供<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/62115518/persistent-layout-in-next-js-with-typescript-and-hoc/65898224#65898224" title="https://stackoverflow.com/questions/62115518/persistent-layout-in-next-js-with-typescript-and-hoc/65898224#65898224">方案</a></p>
<p><code>pages/page.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextPage</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ComponentType</span>, <span class="title class_">ReactElement</span>, <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NextPageWithLayout</span>&lt;P = &#123;&#125;&gt; = <span class="title class_">NextPage</span>&lt;P&gt; &amp; &#123;</span><br><span class="line">    getLayout?: <span class="function">(<span class="params">_page: ReactElement</span>) =&gt;</span> <span class="title class_">ReactNode</span>;</span><br><span class="line">    layout?: <span class="title class_">ComponentType</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当你需要创建自定义 layouts 的页面，你可以使用 <code>NextPageWithLayout</code> 接口来替代 <code>NextPage</code> 接口</p>
<p>现在让我们更新主页</p>
<p><code>pages/index.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">CatCard</span> <span class="keyword">from</span> <span class="string">&quot;../components/cards/cat/CatCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mockCatCardProps &#125; <span class="keyword">from</span> <span class="string">&quot;../components/cards/cat/CatCard.mocks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PrimaryLayout</span> <span class="keyword">from</span> <span class="string">&quot;../components/layouts/primary/PrimaryLayout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SidebarLayout</span> <span class="keyword">from</span> <span class="string">&quot;../components/layouts/sidebar/SidebarLayout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextPageWithLayout</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./page&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span>: <span class="title class_">NextPageWithLayout</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                Welcome to <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;https://nextjs.org&gt;&quot;</span>&gt;</span>Next.js!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">CatCard</span> &#123;<span class="attr">...mockCatCardProps.base</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Home</span>.<span class="property">getLayout</span> = <span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">PrimaryLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">SidebarLayout</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;page&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">PrimaryLayout</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>并且在 <code>pages</code> 目录中创建一个新的 <code>about</code> 页面</p>
<p><code>pages/about.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">PrimaryLayout</span> <span class="keyword">from</span> <span class="string">&quot;../components/layouts/primary/PrimaryLayout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SidebarLayout</span> <span class="keyword">from</span> <span class="string">&quot;../components/layouts/sidebar/SidebarLayout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextPageWithLayout</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./page&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span>: <span class="title class_">NextPageWithLayout</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Layout Example (About)<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                This example adds a property <span class="tag">&lt;<span class="name">code</span>&gt;</span>getLayout<span class="tag">&lt;/<span class="name">code</span>&gt;</span> to your</span></span><br><span class="line"><span class="language-xml">                page, allowing you to return a React component for the layout.</span></span><br><span class="line"><span class="language-xml">                This allows you to define the layout on a per-page basis. Since</span></span><br><span class="line"><span class="language-xml">                we<span class="symbol">&amp;apos;</span>re returning a function, we can have complex nested</span></span><br><span class="line"><span class="language-xml">                layouts if desired.</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                When navigating between pages, we want to persist page state</span></span><br><span class="line"><span class="language-xml">                (input values, scroll position, etc.) for a Single-Page</span></span><br><span class="line"><span class="language-xml">                Application (SPA) experience.</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                This layout pattern will allow for state persistence because the</span></span><br><span class="line"><span class="language-xml">                React component tree is persisted between page transitions. To</span></span><br><span class="line"><span class="language-xml">                preserve state, we need to prevent the React component tree from</span></span><br><span class="line"><span class="language-xml">                being discarded between page transitions.</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Try It Out<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                To visualize this, try tying in the search input in the&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">code</span>&gt;</span>Sidebar<span class="tag">&lt;/<span class="name">code</span>&gt;</span> and then changing routes. You<span class="symbol">&amp;apos;</span>ll</span></span><br><span class="line"><span class="language-xml">                notice the input state is persisted.</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">About</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">About</span>.<span class="property">getLayout</span> = <span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">PrimaryLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">SidebarLayout</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;page&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">PrimaryLayout</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>更新 <code>_app.tsx</code></p>
<p><code>pages/_app.tsx</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AppProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;next/app&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./globals.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextPageWithLayout</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./page&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AppPropsWithLayout</span> <span class="keyword">extends</span> <span class="title class_">AppProps</span> &#123;</span><br><span class="line">    <span class="title class_">Component</span>: <span class="title class_">NextPageWithLayout</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyApp</span>(<span class="params">&#123; Component, pageProps &#125;: AppPropsWithLayout</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果这个 layout 是可用的，则在页面中使用</span></span><br><span class="line">    <span class="keyword">const</span> getLayout = <span class="title class_">Component</span>.<span class="property">getLayout</span> || (<span class="function">(<span class="params">page</span>) =&gt;</span> page);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getLayout</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...pageProps</span>&#125; /&gt;</span></span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyApp</span>;</span><br></pre></td></tr></table></figure>

<p>最后我更新了 <code>PrimaryLayout.mocks.ts</code> 文件，为 <em><code>IPrimaryLayout</code></em> 添加了 <code>children: &#39;&#123;&#123;component&#125;&#125;’</code> 用于在 Storybook 中展示</p>
<p>同时我更新 layout 的 story title 从 <code>templates/...</code>变成  <code>layouts/...</code></p>
<p>最后你可以保存测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<p>在侧边栏（ Home 和 about ）的按钮单击可以进行页面切换。 请注意，所使用的布局将持续存在而无需重新加载（正如我们的意图），并且用户将获得超快速的体验。</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ede7bb0dc56d47059496fcc0a123deda~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="13.png"></p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68f8d8dd53fd4318a2d021e41caa092f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="14.png"></p>
<p>在 Storybook 这边，我们可以独立于应用预览和测试我们的 layout 组件。这个 PrimaryLayout 组件在没有自组件的情况下没有什么作用，而侧边栏则可以完美的显示。</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f957175add54a5d88856e37efdd25bc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="15.png"></p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>最后一步将讲解如何部署一个 Next.js 应用</p>
<p>我们将使用 Vercel，因为它是 Next.js 应用程序最简单、最直接的部署解决方案。</p>
<p>请注意，Vercel 绝对不是唯一的选择，其他主要服务（如 <a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/mobile/host-a-next-js-ssr-app-with-real-time-data-on-aws-amplify/" title="https://aws.amazon.com/blogs/mobile/host-a-next-js-ssr-app-with-real-time-data-on-aws-amplify/">AWS</a>、<a target="_blank" rel="noopener" href="https://www.netlify.com/with/nextjs/" title="https://www.netlify.com/with/nextjs/">Netlify</a> 等）也都可以使用。</p>
<p>假设你使用的不是 <a target="_blank" rel="noopener" href="https://nextjs.org/docs/advanced-features/static-html-export" title="https://nextjs.org/docs/advanced-features/static-html-export">静态站点生成</a> 模式，那么实际上你仅仅需要找个服务来运行 <code>next start</code> 命令就行了</p>
<p>作为一个普通用户在 Vercel 上进行部署是完全免费的，我们需要从<a target="_blank" rel="noopener" href="https://vercel.com/" title="https://vercel.com/">创建账号</a>开始</p>
<p>登录后，单击 <code>+ New Project</code> 并授予 Vercel 访问你的 Github 仓库的权限。 你可以授予全局访问权限，也可以仅选择要部署的仓库。我将选择 <code>nextjs-fullstack-app-template-zn</code> 这个仓库。</p>
<p>选择它后，需要对其进行配置。 在 <code>Build and Output Settings</code> 部分，确保将默认的 NPM 命令替换为 yarn 命令（除非你使用的是 NPM）。</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9c184e6b94b447f914d78a24e2b6ac3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="16.png"></p>
<p>我们还没有使用任何环境变量，所以不需要添加</p>
<p>一旦完成，只需单击 <code>Deploy</code> 即可！ 就这么简单。</p>
<p><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/befa5f520fcf45feb53176af7e9edc75~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="17.png"></p>
<p>现在不仅部署了站点，而且每次提交到主分支时，它都会继续自动重新部署。 如果你不想要这种行为，那么在 Vercel 仪表板中进行配置也很容易。</p>
<p>好消息是，你已经配置了 <code>yarn build</code> 命令以确保在推送代码之前构建有效的生产版本，因此可以自信地推送代码，并假设部署会成功。</p>
<p>唯一需要记住的是两个环境之间的差异。 如果你的脚本不同（使用 NPM 而不是 yarn 或反之亦然），或者更常见的情况是缺少环境变量，你的构建仍然有可能在本地成功但在 Vercel 上失败。</p>
<p>我们将在以后的教程中添加 env 值，因此你需要确保在本地和生产环境中都配置了这些值，因为它们是机密，永远不应提交给公共仓库。</p>
<h2 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h2><p>我希望你找到了本教程并学到了一些知识，为你和你的团队设置可靠且可扩展的 Next.js 项目。</p>
<p>这是关于创建生产高质量 Next.js 应用程序的系列教程的第一部分。</p>
<p>下面是我对未来教程的一些想法，我希望你能留下一些反馈，告诉我哪些是你认为最有用的（如果你没有在下面看到它们，则可以留下其他反馈）</p>
<ul>
<li>如何使用 API 路由和 Tailwind CSS 构建全栈 Next.js 应用程序</li>
<li>如何使用 Recoil 将全局状态管理器添加到 Next.js 应用程序</li>
<li>如何使用 jest 和 playwright 在 Next.js 应用程序中实施单元测试和端到端测试</li>
<li>如何使用 Github actions 和 Vercel 创建 CI&#x2F;CD 流水线</li>
<li>如何使用 NextAuth 和 i18next 在 Next.js 应用程序中实现 SSO 身份验证和国际化</li>
<li>如何使用 Prisma 和 Supabase 将数据库连接到 Next.js 应用程序</li>
<li>如何使用 Next.js 和 Nx 在 monorepo 中管理多个应用程序</li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/zidanDirk/nextjs-fullstack-app-template-zn" title="https://github.com/zidanDirk/nextjs-fullstack-app-template-zn">代码仓库地址</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/alexeagleson/how-to-build-scalable-architecture-for-your-nextjs-project-2pb7" title="https://dev.to/alexeagleson/how-to-build-scalable-architecture-for-your-nextjs-project-2pb7">原文地址</a></li>
<li><a target="_blank" rel="noopener" href="https://main--serene-cobbler-6d3ef4.netlify.app/" title="https://main--serene-cobbler-6d3ef4.netlify.app/">页面地址</a></li>
</ul>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    
    <section id="share">
      <div class="header"><span>分享文章</span></div>
      <div class="body">
        <div class="link"><input class="copy-area" readonly="true" id="copy-link" value="https://stephenykk.github.io/2024/03/12/Nextjs%E9%A1%B9%E7%9B%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" /></div>
        <div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot)"><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/b32ef3da1162a.svg" /></a><a class="social share-item weibo" target="_blank" rel="external nofollow noopener noreferrer" href="https://service.weibo.com/share/share.php?url=https://stephenykk.github.io/2024/03/12/Nextjs%E9%A1%B9%E7%9B%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/&title=Nextjs项目最佳实践 - JKK随笔&summary=
原文地址Next.js 项目最佳实践 - 掘金

什么是 Next.js
“ Next.js 通过提供所有生产环境需要的功能来给你最佳的开发体验：构建时预渲染，服务端渲染，TypeScript 支持，智能打包，路由预加载，零配置等等..."><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/80c07e4dbb303.svg" /></a><a class="social share-item email" href="mailto:?subject=Nextjs项目最佳实践 - JKK随笔&amp;body=https://stephenykk.github.io/2024/03/12/Nextjs%E9%A1%B9%E7%9B%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/a1b00e20f425d.svg" /></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;复制成功&quot;)"><img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/8411ed322ced6.svg" /></a></div>
        
        <div class="qrcode" id="qrcode-wechat" style="opacity:0;height:0">
          <img  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer"  referrerpolicy="no-referrer" class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=https://stephenykk.github.io/2024/03/12/Nextjs%E9%A1%B9%E7%9B%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
        </div>
        
      </div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/03/12/%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9AWebSocket/">十分钟学会WebSocket</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/03/12/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8NextJs/">手把手带你入门NextJs</a></div></section></div>

<div class="related-wrap" id="related-posts">
    <section class='header'>
      <div class='title cap theme'>您可能感兴趣的文章</div>
    </section>
    <section class='body'>
    <div class="related-posts"><a class="item" href="\2024\03\12\手把手带你入门NextJs\" title="手把手带你入门NextJs"><span class="title">手把手带你入门NextJs</span></a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body utterances'>
      

<svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="utterances" repo="stephenykk/discussion" issue-term="pathname" theme="preferred-color-scheme"></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">stephenykk</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.27.0">Stellar 1.27.0</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-Next-js"><span class="toc-text">什么是 Next.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="toc-text">项目创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E6%93%8E%E9%94%81%E5%AE%9A"><span class="toc-text">引擎锁定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-%E9%85%8D%E7%BD%AE"><span class="toc-text">Git 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%92%8C%E8%B4%A8%E9%87%8F%E5%B7%A5%E5%85%B7"><span class="toc-text">代码格式化和质量工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ESLint"><span class="toc-text">ESLint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prettier"><span class="toc-text">Prettier</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Hooks"><span class="toc-text">Git Hooks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VS-Code-%E9%85%8D%E7%BD%AE"><span class="toc-text">VS Code 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-text">调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-Storybook"><span class="toc-text">添加 Storybook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6%E6%A8%A1%E7%89%88"><span class="toc-text">创建一个组件模版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BB%84%E4%BB%B6%E6%A8%A1%E7%89%88"><span class="toc-text">使用组件模版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E6%A1%A3"><span class="toc-text">添加自定义文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-Layouts"><span class="toc-text">添加 Layouts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-text">部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5"><span class="toc-text">下一步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-text">其他</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.27.0" async></script>

<!-- optional -->

  <script>
  function loadUtterances() {
    const els = document.querySelectorAll("#comments #utterances");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.error(error);
      }
      var script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
      loadUtterances();
  });
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?527d24f1a4c0bef6256d4231fa3c74ac";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || null
        }
      });
    })
  }
</script><script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          loop: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script><script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
